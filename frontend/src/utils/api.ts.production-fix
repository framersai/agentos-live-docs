// File: frontend/src/utils/api.ts
/**
 * @file API Utility
 * @description Centralized Axios instance and API endpoint definitions for frontend-backend communication.
 * Handles base URL configuration, authentication token injection, and basic error interception.
 * All functions are designed to be type-safe and adhere to modern TypeScript practices.
 * @version 1.4.2 - Fixed production API URL handling
 */
import axios, { type AxiosInstance, type InternalAxiosRequestConfig, type AxiosResponse } from 'axios';

// Environment variables for API configuration.
// For production with Nginx proxy, use relative URL '/api' instead of full URL
const API_BASE_URL: string = import.meta.env.VITE_API_BASE_URL ||
  (window.location.hostname === 'localhost' ? 'http://localhost:3001/api' : '/api');

/**
 * Key used for storing the authentication token in localStorage or sessionStorage.
 * @constant {string}
 */
export const AUTH_TOKEN_KEY: string = 'vcaAuthToken';

/**
 * Main Axios instance for API communication.
 * Configured with a base URL, timeout, and default headers.
 * @type {AxiosInstance}
 */
export const api: AxiosInstance = axios.create({
  baseURL: API_BASE_URL,
  timeout: 90000, // 90 seconds timeout for potentially long operations
  headers: {
    'Content-Type': 'application/json',
    'X-Client-Version': '1.4.2', // Updated client version
  },
});

console.log(`[API Service] Initialized. Base URL: ${api.defaults.baseURL}`);

// ... rest of the file remains the same