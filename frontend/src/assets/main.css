/* Voice Coding Assistant - Complete Modern Styling System */

/* Import fonts first - these must come before other CSS rules */
@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap');
@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&display=swap');

/* Tailwind directives */
@tailwind base;
@tailwind components;
@tailwind utilities;

/* CSS Custom Properties (Variables) - Retained for broad compatibility and explicit theming */
:root {
  /* Primary Colors */
  --primary-50: #eff6ff;
  --primary-100: #dbeafe;
  --primary-200: #bfdbfe;
  --primary-300: #93c5fd;
  --primary-400: #60a5fa;
  --primary-500: #3b82f6;
  --primary-600: #2563eb;
  --primary-700: #1d4ed8;
  --primary-800: #1e40af;
  --primary-900: #1e3a8a;
  
  /* Semantic Colors */
  --success: #10b981;
  --warning: #f59e0b;
  --error: #ef4444;
  --info: #3b82f6;
  
  /* UI Colors */
  --glass-bg: rgba(255, 255, 255, 0.7);
  --glass-border: rgba(255, 255, 255, 0.2);
  --shadow-subtle: 0 1px 3px rgba(0, 0, 0, 0.1);
  --shadow-medium: 0 4px 6px rgba(0, 0, 0, 0.1);
  --shadow-large: 0 10px 15px rgba(0, 0, 0, 0.1);
  
  /* Animation Durations */
  --duration-fast: 150ms;
  --duration-normal: 300ms;
  --duration-slow: 500ms;
  
  /* Border Radius */
  --radius-sm: 0.375rem; /* 6px */
  --radius-md: 0.5rem;   /* 8px */
  --radius-lg: 0.75rem;  /* 12px */
  --radius-xl: 1rem;     /* 16px */
  --radius-2xl: 1.5rem;  /* 24px */
  
  /* Spacing Scale (can be used alongside Tailwind spacing) */
  --space-xs: 0.25rem;
  --space-sm: 0.5rem;
  --space-md: 1rem;
  --space-lg: 1.5rem;
  --space-xl: 2rem;
  --space-2xl: 3rem;
}

.dark {
  --glass-bg: rgba(31, 41, 55, 0.7); /* Equivalent to dark:bg-gray-800 with opacity */
  --glass-border: rgba(75, 85, 99, 0.2); /* Equivalent to dark:border-gray-700 with opacity */
  --shadow-subtle: 0 1px 3px rgba(0, 0, 0, 0.3);
  --shadow-medium: 0 4px 6px rgba(0, 0, 0, 0.3);
  --shadow-large: 0 10px 15px rgba(0, 0, 0, 0.3);
}

/* Base Layer - Reset and Typography */
@layer base {
  html {
    @apply font-sans antialiased; /* Use Tailwind's font-sans from config */
    scroll-behavior: smooth;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  
  body {
    @apply bg-gradient-to-br from-gray-50 via-white to-gray-100 
           dark:from-gray-900 dark:via-gray-900 dark:to-gray-800 
           text-gray-900 dark:text-gray-100 
           leading-relaxed;
    font-feature-settings: 'kern' 1, 'liga' 1, 'ss01' 1; /* Keep specific font features */
    text-rendering: optimizeLegibility;
  }
  
  /* Enhanced Typography Scale */
  h1, h2, h3, h4, h5, h6 {
    @apply font-semibold tracking-tight;
    font-feature-settings: 'kern' 1, 'liga' 1, 'ss01' 1;
  }
  
  h1 { @apply text-3xl sm:text-4xl lg:text-5xl leading-tight; }
  h2 { @apply text-2xl sm:text-3xl lg:text-4xl leading-tight; }
  h3 { @apply text-xl sm:text-2xl leading-snug; }
  h4 { @apply text-lg sm:text-xl leading-snug; }
  
  /* Code Typography */
  code, pre {
    @apply font-mono; /* Use Tailwind's font-mono from config */
    font-feature-settings: 'liga' 1, 'calt' 1; /* Common ligatures for code */
  }
  
  /* Enhanced Scrollbars */
  ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  ::-webkit-scrollbar-track {
    @apply bg-gray-100 dark:bg-gray-800 rounded-full;
  }
  ::-webkit-scrollbar-thumb {
    @apply bg-gray-300 dark:bg-gray-600 rounded-full transition-colors duration-150 ease-in-out;
  }
  ::-webkit-scrollbar-thumb:hover {
    @apply bg-gray-400 dark:bg-gray-500;
  }
  ::-webkit-scrollbar-corner {
    @apply bg-transparent;
  }
  
  /* Firefox scrollbar */
  * {
    scrollbar-width: thin;
    scrollbar-color: theme('colors.gray.400') theme('colors.gray.100'); /* Using Tailwind theme function */
  }
  .dark * {
    scrollbar-color: theme('colors.gray.600') theme('colors.gray.800');
  }
  
  /* Selection Styles */
  ::selection {
    @apply bg-primary-200 dark:bg-primary-700 text-primary-900 dark:text-primary-100;
  }
  
  /* Focus Styles - Consistent global focus ring */
  :focus-visible {
    @apply outline-none ring-2 ring-primary-500 ring-offset-2 
           ring-offset-white dark:ring-offset-gray-900 rounded-sm;
  }
  
  /* Global transitions - Use with caution for performance. Applied for theme switching primarily. */
  body, body::before, body::after { /* Scoped to body and its pseudo-elements */
    transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, box-shadow;
    transition-duration: var(--duration-normal);
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  }
}

/* Component Layer - Reusable UI Components */
@layer components {
  
  /* Button System */
  .btn {
    @apply inline-flex items-center justify-center gap-2 
           px-4 py-2 rounded-lg font-medium 
           transition-all duration-200 ease-out
           focus-visible:outline-none focus-visible:ring-2 
           focus-visible:ring-offset-2 
           disabled:opacity-60 disabled:cursor-not-allowed
           relative overflow-hidden select-none /* Prevent text selection on click */
           hover:scale-[1.03] active:scale-[0.98]; /* Subtle hover/active effect */
  }
  
  .btn-primary {
    @apply btn bg-gradient-to-r from-primary-600 to-primary-700 
           hover:from-primary-700 hover:to-primary-800 
           text-white shadow-md hover:shadow-lg
           focus-visible:ring-primary-500;
  }
  
  .btn-secondary {
    @apply btn bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600
           text-gray-700 dark:text-gray-200 
           hover:bg-gray-50 dark:hover:bg-gray-600
           shadow-sm hover:shadow-md
           focus-visible:ring-gray-500;
  }
  
  .btn-ghost {
    @apply btn text-gray-600 dark:text-gray-300 
           hover:bg-gray-100 dark:hover:bg-gray-700/50 /* Slight dark mode adjustment */
           focus-visible:ring-gray-500;
  }
  
  .btn-sm { @apply px-3 py-1.5 text-sm rounded-md; } /* Adjusted rounding */
  .btn-lg { @apply px-6 py-3 text-lg; }
  
  /* Ripple Effect for Buttons */
  .btn::before {
    content: '';
    @apply absolute inset-0 rounded-lg opacity-0 bg-white/30 dark:bg-white/10;
    transform: scale(0.5); /* Start smaller for a more subtle expand */
    transition: transform 0.4s ease-out, opacity 0.4s ease-out;
  }
  .btn:active::before {
    transform: scale(1.5); /* Expand further */
    @apply opacity-100;
    transition: transform 0s, opacity 0s; /* Instant effect on active */
  }
  
  /* Glass Effect Components */
  .glass {
    background: var(--glass-bg);
    backdrop-filter: blur(12px) saturate(180%);
    -webkit-backdrop-filter: blur(12px) saturate(180%); /* For Safari */
    border: 1px solid var(--glass-border);
    box-shadow: var(--shadow-medium);
  }
  .glass-subtle {
    background: var(--glass-bg);
    backdrop-filter: blur(8px) saturate(150%);
    -webkit-backdrop-filter: blur(8px) saturate(150%); /* For Safari */
    border: 1px solid var(--glass-border);
    box-shadow: var(--shadow-subtle);
  }
  
  /* Card System */
  .card {
    @apply bg-white dark:bg-gray-800 rounded-xl shadow-sm 
           border border-gray-200 dark:border-gray-700
           transition-all duration-300 ease-out;
  }
  .card-hover {
    @apply card hover:shadow-lg hover:scale-[1.02] hover:-translate-y-1;
  }
  .card-interactive { @apply card-hover cursor-pointer; }
  .card-glass { @apply glass rounded-xl; }
  
  /* Form Elements */
  .input {
    @apply w-full px-4 py-2.5 bg-white dark:bg-gray-800 
           border border-gray-300 dark:border-gray-600 
           rounded-lg shadow-sm
           text-gray-900 dark:text-gray-100
           placeholder:text-gray-400 dark:placeholder:text-gray-500 /* Adjusted placeholder contrast */
           focus:ring-2 focus:ring-primary-500 focus:border-primary-500
           disabled:bg-gray-100 dark:disabled:bg-gray-700/50 disabled:cursor-not-allowed
           transition-all duration-200 ease-in-out; /* Transition all relevant properties */
  }
  .input-error {
    @apply input border-red-400 dark:border-red-500 
           focus:ring-red-500 focus:border-red-500
           placeholder:text-red-400 dark:placeholder:text-red-500;
  }
  .select {
    @apply input appearance-none pr-10 bg-no-repeat bg-right cursor-pointer;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
    background-position: right 0.75rem center;
    background-size: 1.25em 1.25em; /* Use em for better scaling with text */
  }
  .dark .select { /* Dark mode select arrow */
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%239ca3af' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
  }
  .textarea {
    @apply input min-h-[120px] resize-y; /* Increased min-height */
  }
  
  /* Toggle Switch */
  .toggle {
    @apply relative inline-flex h-6 w-11 items-center rounded-full
           bg-gray-200 dark:bg-gray-700
           transition-colors duration-200 ease-in-out
           focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2
           cursor-pointer;
  }
  .toggle.checked { @apply bg-primary-600; }
  .toggle .toggle-thumb {
    @apply inline-block h-4 w-4 transform rounded-full bg-white
           shadow-sm ring-1 ring-gray-900/5 /* Subtle ring for definition */
           transition-transform duration-200 ease-in-out;
    translate: 0.25rem; /* Adjusted for better visual balance */
  }
  .toggle.checked .toggle-thumb { translate: 1.5rem; } /* Adjusted for better visual balance */

  /* Voice Input Components */
  .voice-button {
    @apply relative flex items-center justify-center 
           w-16 h-16 sm:w-18 sm:h-18 /* Uses the '18' unit from tailwind.config.js for sm+ screens */
           rounded-full shadow-lg hover:shadow-xl
           transform transition-all duration-300 ease-out
           focus:outline-none focus:ring-4 focus:ring-offset-2
           active:scale-95 hover:scale-105;
  }
  .voice-button-idle {
    @apply voice-button bg-gradient-to-br from-primary-500 to-primary-600 /* Adjusted gradient direction */
           text-white focus:ring-primary-400 dark:focus:ring-primary-600;
  }
  .voice-button-recording {
    @apply voice-button bg-gradient-to-br from-red-500 to-red-600
           text-white focus:ring-red-400 dark:focus:ring-red-600 animate-pulse; /* Added subtle pulse */
  }
  .voice-button-continuous {
    @apply voice-button bg-gradient-to-br from-green-500 to-green-600
           text-white focus:ring-green-400 dark:focus:ring-green-600;
  }

  /* Voice button pulse animation (uses keyframes from tailwind.config.js) */
  .voice-button-recording::before,
  .voice-button-continuous::before {
    content: '';
    @apply absolute inset-0 rounded-full opacity-75 animate-voice-pulse;
    /* background-color matches the button's base or a contrasting pulse color */
    background-color: currentColor; 
  }
  .voice-button-recording::after,
  .voice-button-continuous::after {
    content: '';
    @apply absolute inset-0 rounded-full opacity-50 animate-voice-pulse;
    animation-delay: 0.5s; /* Offset the second pulse */
    background-color: currentColor;
  }

  /* Message Bubbles */
  .message-bubble {
    @apply relative p-4 sm:p-5 rounded-2xl shadow-md /* Slightly increased shadow */
           transition-all duration-300 ease-out max-w-3xl; /* Adjusted max-width */
  }
  .message-user {
    @apply message-bubble bg-gradient-to-r from-primary-50 to-blue-100 
           dark:from-primary-900/40 dark:to-blue-900/30
           border-l-4 border-primary-500 dark:border-primary-600
           ml-auto mr-4 sm:mr-8 rounded-tr-lg rounded-br-lg rounded-tl-2xl rounded-bl-2xl; /* More distinct shape */
  }
  .message-assistant {
    @apply message-bubble bg-white dark:bg-gray-800/90
           border-l-4 border-gray-300 dark:border-gray-600
           mr-auto ml-4 sm:ml-8 rounded-tl-lg rounded-bl-lg rounded-tr-2xl rounded-br-2xl; /* More distinct shape */
  }
  
  /* Code Blocks */
  .code-block {
    @apply relative bg-gray-900 dark:bg-gray-950/70 rounded-lg overflow-hidden
           shadow-xl border border-gray-700 dark:border-gray-700/50 my-4; /* Added margin */
  }
  .code-header {
    @apply flex items-center justify-between px-4 py-2.5 /* Adjusted padding */
           bg-gray-800 dark:bg-gray-900/80 border-b border-gray-700 dark:border-gray-700/60
           text-gray-300 text-xs font-mono; /* Smaller, mono font for language */
  }
  .code-content {
    @apply p-4 text-sm leading-relaxed;
  }
  /* For pre within .code-content, if using highlight.js or similar */
  .code-content pre {
    @apply !bg-transparent !p-0 overflow-x-auto; /* Reset hljs default background and padding */
  }
  .code-copy-btn {
    @apply p-1.5 rounded text-gray-400 hover:text-white hover:bg-gray-700
           transition-colors duration-200 opacity-50 hover:opacity-100 focus:opacity-100;
    /* Position absolutely within .code-header or .code-block if needed */
  }
  .code-block:hover .code-copy-btn { /* Show on hover of block */
    @apply opacity-100;
  }
  
  /* Loading States */
  .loading-spinner {
    @apply inline-block w-6 h-6 border-[3px] border-current border-t-transparent /* Slightly bolder */
           rounded-full animate-spin;
  }
  .loading-dots { @apply inline-flex gap-1.5; } /* Slightly more gap */
  .loading-dots span {
    @apply w-2 h-2 bg-current rounded-full opacity-75 animate-loading-dots;
  }
  .loading-dots span:nth-child(1) { animation-delay: -0.32s; }
  .loading-dots span:nth-child(2) { animation-delay: -0.16s; }
  /* nth-child(3) has 0s delay by default from keyframes */
  
  /* Skeleton Loaders */
  .skeleton {
    @apply bg-gray-200 dark:bg-gray-700 rounded animate-pulse;
  }
  .skeleton-text { @apply skeleton h-4 my-1.5; } /* Adjusted margin */
  .skeleton-text-lg { @apply skeleton h-6 my-2; }
  .skeleton-avatar { @apply skeleton w-10 h-10 rounded-full; }
  .skeleton-btn { @apply skeleton w-24 h-10 rounded-lg; }

  /* Toast Notifications */
  .toast {
    @apply glass rounded-lg p-4 shadow-xl border max-w-md /* Increased max-width */
           transform transition-all duration-300 ease-out;
  }
  .toast-success { @apply toast border-green-300 dark:border-green-600/70; }
  .toast-error   { @apply toast border-red-300 dark:border-red-600/70; }
  .toast-warning { @apply toast border-yellow-300 dark:border-yellow-600/70; }
  .toast-info    { @apply toast border-blue-300 dark:border-blue-600/70; }
  
  /* Animation Classes (Vue/React transition group classes) */
  .slide-enter-active,
  .slide-leave-active { @apply transition-all duration-300 ease-out; }
  .slide-enter-from   { @apply opacity-0 transform translate-x-6; } /* Slide from further */
  .slide-leave-to     { @apply opacity-0 transform -translate-x-6; }

  .fade-enter-active,
  .fade-leave-active  { @apply transition-opacity duration-300 ease-out; }
  .fade-enter-from,
  .fade-leave-to      { @apply opacity-0; }

  .scale-enter-active,
  .scale-leave-active { @apply transition-all duration-200 ease-out; }
  .scale-enter-from,
  .scale-leave-to     { @apply opacity-0 transform scale-90; } /* More pronounced scale */
}

/* Utility Layer - Helper Classes (can also be defined in tailwind.config.js if they generate variants) */
@layer utilities {
  /* Custom Spacing - Tailwind typically covers this with space-y-*, but if needed */
  .space-y-0\.5 > :not([hidden]) ~ :not([hidden]) { margin-top: 0.125rem; } 
  
  /* Custom Aspect Ratios */
  .aspect-golden { aspect-ratio: 1.618 / 1; }
  
  /* Text Balance (browser support varies) */
  .text-balance { text-wrap: balance; }
  
  /* Hide scrollbar but keep functionality */
  .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
  .scrollbar-hide::-webkit-scrollbar { display: none; }
  
  /* Custom Focus Ring (example) */
  .focus-ring-primary {
    @apply focus:outline-none focus:ring-2 focus:ring-primary-500 
           focus:ring-offset-2 focus:ring-offset-white 
           dark:focus:ring-offset-gray-900;
  }
  
  /* Safe Area for Mobile (iOS specific) */
  .safe-top    { padding-top: env(safe-area-inset-top); }
  .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
  .safe-left   { padding-left: env(safe-area-inset-left); }
  .safe-right  { padding-right: env(safe-area-inset-right); }

  /* Text Gradients */
  .text-gradient {
    @apply bg-clip-text text-transparent 
           bg-gradient-to-r from-primary-500 via-primary-600 to-primary-700
           dark:from-primary-400 dark:via-primary-500 dark:to-primary-600;
  }
  .text-gradient-rainbow {
    @apply bg-clip-text text-transparent 
           bg-gradient-to-r from-red-500 via-yellow-400 via-green-500 via-blue-500 to-purple-600
           animate-gradient-shift; /* Example of applying animation utility */
    background-size: 200% auto; /* For gradient animation */
  }
  
  /* Border Gradient Container */
  .border-gradient {
    @apply p-px rounded-lg bg-gradient-to-r from-primary-500 to-primary-700;
  }
  .border-gradient > * { /* Child element needs its own background */
    @apply bg-white dark:bg-gray-800 h-full w-full rounded-[calc(0.5rem-1px)]; /* Adjust rounding based on parent */
  }

  /* Shadow Glow */
  .shadow-glow-primary {
    box-shadow: 0 0 15px 0px theme('colors.primary.500 / 30%'), 0 0 30px 0px theme('colors.primary.500 / 20%');
  }
  .dark .shadow-glow-primary {
    box-shadow: 0 0 20px 0px theme('colors.primary.400 / 40%'), 0 0 40px 0px theme('colors.primary.400 / 30%');
  }
}

/* SPECIFIC MEDIA QUERIES & RESPONSIVE OVERRIDES
  Migrate styles from 'responsive.css' here, prioritizing Tailwind's responsive prefixes.
  Only use explicit @media queries for cases not easily handled by Tailwind (e.g., orientation, height, complex conditions).
*/

/* Example of a complex media query from your original main.css */
@media (max-height: 600px) and (orientation: landscape) {
  .voice-button {
    @apply w-12 h-12; /* Further reduce size in constrained landscape */
  }
  .message-bubble {
    @apply p-3 text-sm; /* Compact messages in this mode */
  }
}

/* Reduced motion for accessibility */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
  /* Disable specific looping animations */
  .animate-voice-pulse,
  .animate-loading-dots,
  .animate-shimmer,
  .animate-gradient-shift,
  .animate-bounce-subtle,
  .animate-wiggle {
    animation: none !important;
  }
  .voice-button-recording::before,
  .voice-button-recording::after,
  .voice-button-continuous::before,
  .voice-button-continuous::after {
    animation: none !important; /* Target specific pseudo-elements if not using utility */
  }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  .glass, .glass-subtle {
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
    background: rgba(255, 255, 255, 0.95);
    @apply border-2 border-black dark:border-white;
  }
  .dark .glass, .dark .glass-subtle {
    background: rgba(10, 10, 10, 0.95); /* Near black for high contrast dark */
  }
  .btn-primary {
    @apply border-2 border-black dark:border-white;
  }
  .btn-secondary {
    @apply border-2 border-black dark:border-white;
  }
}

/* Print styles - (Incorporated relevant parts from responsive.css) */
@media print {
  body {
    @apply bg-white text-black; /* Basic print defaults */
  }
  .app-header, /* Example: hide non-content elements */
  .voice-input-container,
  .btn, /* Hide interactive buttons */
  [class*="animate-"] { /* Hide animated elements */
    display: none !important;
  }

  .glass, .glass-subtle {
    print-color-adjust: exact;
    -webkit-print-color-adjust: exact;
    background: #fff !important;
    border: 1px solid #ccc !important;
    box-shadow: none !important;
  }
  
  .message-bubble {
    break-inside: avoid;
    @apply shadow-none border border-gray-300 p-3 my-2 max-w-full;
  }
  .message-user { @apply bg-gray-50 border-blue-600; }
  .message-assistant { @apply bg-white border-gray-500; }

  .code-block {
    @apply shadow-none border border-gray-400;
    page-break-inside: avoid;
  }
  .code-content pre {
    @apply bg-gray-100 text-black;
    color-adjust: exact;
    -webkit-print-color-adjust: exact;
  }

  a { text-decoration: underline; color: #000; }
  a[href^="http"]:after { content:" (" attr(href) ") "; } /* Show URLs for external links */
}