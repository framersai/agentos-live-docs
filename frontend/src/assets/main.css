/* File: frontend/src/assets/main.css */
/**
 * @file main.css
 * @description Core styling for the Voice Coding Assistant.
 * Implements a "Holographic Analog-esque" theme with robust
 * functionality and enhanced visual feedback.
 * @version 4.0.2 - Circular dependency and scale class fixes.
 */

/* --- Font Imports --- */
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&display=swap'); /* Display/Holographic Titles */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap'); /* Main UI Font */
@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap'); /* Code */

/* --- Tailwind Directives --- */
@tailwind base;
@tailwind components;
@tailwind utilities;

/* --- Root Variables & Theming System --- */
:root {
  /* Color System (HSL for flexibility) */
  --primary-hue: 260; /* Deep Violet/Indigo */
  --primary-saturation: 75%;
  --primary-lightness-base: 50%;
  --primary-lightness-light: 65%;
  --primary-lightness-dark: 35%;
  --primary-lightness-focus: 70%;

  --primary-color-hsl: var(--primary-hue) var(--primary-saturation) var(--primary-lightness-base);
  --primary-light-hsl: var(--primary-hue) var(--primary-saturation) var(--primary-lightness-light);
  --primary-dark-hsl: var(--primary-hue) var(--primary-saturation) var(--primary-lightness-dark);
  --primary-focus-hsl: var(--primary-hue) calc(var(--primary-saturation) + 10%) var(--primary-lightness-focus);

  --accent-hue: 180; /* Bright Cyan/Teal */
  --accent-saturation: 90%;
  --accent-lightness-base: 55%;
  --accent-lightness-light: 65%;
  --accent-lightness-dark: 45%;
  --accent-lightness-focus: 70%;

  --accent-color-hsl: var(--accent-hue) var(--accent-saturation) var(--accent-lightness-base);
  --accent-light-hsl: var(--accent-hue) var(--accent-saturation) var(--accent-lightness-light);
  --accent-dark-hsl: var(--accent-hue) var(--accent-saturation) var(--accent-lightness-dark);
  --accent-focus-hsl: var(--accent-hue) calc(var(--accent-saturation) + 5%) var(--accent-lightness-focus);

  /* Neutral (Grays, for backgrounds, text, borders) */
  --neutral-hue-light: 220; /* Cool gray for light mode */
  --neutral-saturation-light: 12%;
  --neutral-hue-dark: 230; /* Cool deep blue-gray for dark mode */
  --neutral-saturation-dark: 15%;

  /* Holographic Accents Palette */
  --holo-cyan-hsl: 180 95% 60%;
  --holo-magenta-hsl: 300 95% 65%;
  --holo-blue-hsl: 220 95% 70%;
  --holo-green-hsl: 140 85% 55%;
  --holo-purple-hsl: 270 90% 70%;

  /* Semantic Colors */
  --success-hue: 145;
  --success-saturation: 70%;
  --success-lightness: 45%;
  --success-color-hsl: var(--success-hue) var(--success-saturation) var(--success-lightness);
  --warning-hue: 40;
  --warning-saturation: 95%;
  --warning-lightness: 55%;
  --warning-color-hsl: var(--warning-hue) var(--warning-saturation) var(--warning-lightness);
  --error-hue: 0;
  --error-saturation: 85%;
  --error-lightness: 58%;
  --error-color-hsl: var(--error-hue) var(--error-saturation) var(--error-lightness);
  --info-hue: var(--accent-hue);
  --info-saturation: var(--accent-saturation);
  --info-lightness: var(--accent-lightness-base);
  --info-color-hsl: var(--info-hue) var(--info-saturation) var(--info-lightness);

  /* Typography */
  --font-sans: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
  --font-mono: 'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  --font-display: 'Orbitron', var(--font-sans);

  /* Borders & Radius */
  --radius-sm: 0.3rem;
  --radius-md: 0.6rem;
  --radius-lg: 0.9rem;
  --radius-xl: 1.25rem;
  --radius-2xl: 1.75rem;
  --radius-3xl: 2.5rem;
  --radius-full: 9999px;
  --radius-holo: var(--radius-lg);

  --border-width-base: 1px;
  --border-width-thick: 2px;
  --border-width-thicker: 3px;

  /* Transitions & Animations */
  --duration-instant: 100ms;
  --duration-quick: 200ms;
  --duration-smooth: 350ms;
  --duration-slow: 600ms;
  --ease-in-out-sine: cubic-bezier(0.37, 0, 0.63, 1);
  --ease-out-quad: cubic-bezier(0.5, 1, 0.89, 1);
  --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
  --ease-elastic: cubic-bezier(0.68, -0.6, 0.32, 1.6);

  /* Layout Dimensions */
  --header-height: 4.5rem; /* 72px */
  --footer-height: 3.75rem; /* 60px */
  --sidebar-width: 280px;

  /* Shadow Base */
  --shadow-color-hsl: 220 40% 10%;
  --shadow-color-highlight-hsl: 220 20% 90%;

  /* Light Theme Specifics */
  --text-primary-hsl-light: var(--neutral-hue-light) 10% 10%;
  --text-secondary-hsl-light: var(--neutral-hue-light) 8% 35%;
  --text-muted-hsl-light: var(--neutral-hue-light) 10% 55%;
  --text-inverted-hsl-light: var(--neutral-hue-light) 15% 98%;
  --text-placeholder-hsl-light: var(--neutral-hue-light) 10% 65%;
  --bg-base-hsl-light: var(--neutral-hue-light) 15% 97%;
  --bg-surface-hsl-light: var(--neutral-hue-light) 20% 100%;
  --bg-elevated-hsl-light: var(--neutral-hue-light) 18% 98%;
  --bg-subtle-hsl-light: var(--neutral-hue-light) 15% 94%;
  --border-color-hsl-light: var(--neutral-hue-light) 12% 88%;
  --border-light-hsl-light: var(--neutral-hue-light) 12% 92%;
  --border-dark-hsl-light: var(--neutral-hue-light) 10% 75%;
  --border-interactive-hsl-light: var(--primary-hue) 50% 70%;
  --glass-bg-light: hsla(var(--neutral-hue-light), 30%, 98%, 0.65);
  --glass-border-light: hsla(var(--neutral-hue-light), 25%, 90%, 0.5);
  --glass-shadow-light: 0 8px 32px 0 hsla(var(--shadow-color-hsl), 5%, 30%, 0.1);
  --glass-blur-light: 12px;
  --scrollbar-track-bg-light: hsl(var(--neutral-hue-light) var(--neutral-saturation-light) 92%);
  --scrollbar-thumb-bg-light: hsl(var(--neutral-hue-light) var(--neutral-saturation-light) 75%);
  --scrollbar-thumb-hover-bg-light: hsl(var(--neutral-hue-light) var(--neutral-saturation-light) 65%);

  /* Dark Theme Specifics */
  --text-primary-hsl-dark: var(--neutral-hue-dark) 20% 92%;
  --text-secondary-hsl-dark: var(--neutral-hue-dark) 15% 70%;
  --text-muted-hsl-dark: var(--neutral-hue-dark) 10% 50%;
  --text-inverted-hsl-dark: var(--neutral-hue-dark) 5% 5%;
  --text-placeholder-hsl-dark: var(--neutral-hue-dark) 10% 45%;
  --bg-base-hsl-dark: 230 20% 7%;
  --bg-surface-hsl-dark: 230 18% 10%;
  --bg-elevated-hsl-dark: 230 16% 13%;
  --bg-subtle-hsl-dark: 230 20% 5%;
  --border-color-hsl-dark: var(--neutral-hue-dark) 10% 22%;
  --border-light-hsl-dark: var(--neutral-hue-dark) 10% 28%;
  --border-dark-hsl-dark: var(--neutral-hue-dark) 8% 15%;
  --border-interactive-hsl-dark: var(--accent-hue) 70% 55%;
  --glass-bg-dark: hsla(var(--neutral-hue-dark), 15%, 10%, 0.7);
  --glass-border-dark: hsla(var(--neutral-hue-dark), 10%, 20%, 0.3);
  --glass-shadow-dark: 0 10px 35px 0 hsla(var(--neutral-hue-dark), 25%, 5%, 0.35);
  --glass-blur-dark: 16px;
  --scrollbar-track-bg-dark: hsl(var(--neutral-hue-dark) var(--neutral-saturation-dark) 12%);
  --scrollbar-thumb-bg-dark: hsl(var(--neutral-hue-dark) var(--neutral-saturation-dark) 30%);
  --scrollbar-thumb-hover-bg-dark: hsl(var(--neutral-hue-dark) var(--neutral-saturation-dark) 40%);

  /* Default to Light Theme */
  --text-primary-hsl: var(--text-primary-hsl-light);
  --text-secondary-hsl: var(--text-secondary-hsl-light);
  --text-muted-hsl: var(--text-muted-hsl-light);
  --text-inverted-hsl: var(--text-inverted-hsl-light);
  --text-placeholder-hsl: var(--text-placeholder-hsl-light);
  --bg-base-hsl: var(--bg-base-hsl-light);
  --bg-surface-hsl: var(--bg-surface-hsl-light);
  --bg-elevated-hsl: var(--bg-elevated-hsl-light);
  --bg-subtle-hsl: var(--bg-subtle-hsl-light);
  --border-color-hsl: var(--border-color-hsl-light);
  --border-light-hsl: var(--border-light-hsl-light);
  --border-dark-hsl: var(--border-dark-hsl-light);
  --border-interactive-hsl: var(--border-interactive-hsl-light);
  --glass-bg: var(--glass-bg-light);
  --glass-border: var(--glass-border-light);
  --glass-shadow: var(--glass-shadow-light);
  --glass-blur: var(--glass-blur-light);
  --scrollbar-track-bg: var(--scrollbar-track-bg-light);
  --scrollbar-thumb-bg: var(--scrollbar-thumb-bg-light);
  --scrollbar-thumb-hover-bg: var(--scrollbar-thumb-hover-bg-light);

  --angle: 0deg;
}

.dark {
  --text-primary-hsl: var(--text-primary-hsl-dark);
  --text-secondary-hsl: var(--text-secondary-hsl-dark);
  --text-muted-hsl: var(--text-muted-hsl-dark);
  --text-inverted-hsl: var(--text-inverted-hsl-dark);
  --text-placeholder-hsl: var(--text-placeholder-hsl-dark);
  --bg-base-hsl: var(--bg-base-hsl-dark);
  --bg-surface-hsl: var(--bg-surface-hsl-dark);
  --bg-elevated-hsl: var(--bg-elevated-hsl-dark);
  --bg-subtle-hsl: var(--bg-subtle-hsl-dark);
  --border-color-hsl: var(--border-color-hsl-dark);
  --border-light-hsl: var(--border-light-hsl-dark);
  --border-dark-hsl: var(--border-dark-hsl-dark);
  --border-interactive-hsl: var(--border-interactive-hsl-dark);
  --glass-bg: var(--glass-bg-dark);
  --glass-border: var(--glass-border-dark);
  --glass-shadow: var(--glass-shadow-dark);
  --glass-blur: var(--glass-blur-dark);
  --scrollbar-track-bg: var(--scrollbar-track-bg-dark);
  --scrollbar-thumb-bg: var(--scrollbar-thumb-bg-dark);
  --scrollbar-thumb-hover-bg: var(--scrollbar-thumb-hover-bg-dark);
}

/* --- Base Layer --- */
@layer base {
  html {
    font-family: var(--font-sans);
    line-height: 1.65;
    @apply antialiased subpixel-antialiased;
    scroll-behavior: smooth;
    text-rendering: optimizeLegibility;
    -webkit-tap-highlight-color: transparent;
    color-scheme: light dark;
    background-color: hsl(var(--bg-base-hsl));
    color: hsl(var(--text-primary-hsl));
    @apply transition-default; /* Uses utility from tailwind.config.js */
  }

  body {
    @apply bg-neutral-bg text-neutral-text;
    font-feature-settings: 'kern' on, 'liga' on, 'clig' on, 'calt' on;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    background-image: linear-gradient(160deg, hsl(var(--primary-dark-hsl) / 0.05) 0%, hsl(var(--accent-dark-hsl) / 0.03) 50%, hsl(var(--primary-dark-hsl) / 0.05) 100%),
                      var(--bg-analog-noise);
    background-size: 300% 300%, 150px 150px;
    animation: gradient-bg-anim 30s ease infinite;
    overflow-x: hidden;
  }

  .dark body {
    background-image: linear-gradient(160deg, hsl(var(--primary-dark-hsl) / 0.2) 0%, hsl(var(--accent-dark-hsl) / 0.1) 50%, hsl(var(--primary-dark-hsl) / 0.2) 100%),
                      var(--bg-analog-noise);
  }

  h1, h2, h3, h4, h5, h6 {
    @apply font-semibold tracking-tight text-neutral-text;
    font-family: var(--font-display);
    text-wrap: balance;
    letter-spacing: -0.01em;
  }
  h1 { @apply text-4xl sm:text-5xl lg:text-6xl font-bold leading-tight; }
  h2 { @apply text-3xl sm:text-4xl lg:text-5xl font-bold; }
  h3 { @apply text-2xl sm:text-3xl font-semibold; }
  h4 { @apply text-xl sm:text-2xl font-semibold; }

  p { @apply mb-5 leading-relaxed text-neutral-text-secondary text-base sm:text-[1.0625rem]; }

  a {
    @apply text-primary-500 hover:text-primary-focus font-medium underline-offset-4 focus:outline-none
           transition-colors duration-[var(--duration-quick)] ease-[var(--ease-out-quad)];
  }
  .dark a { @apply text-primary-light hover:text-primary-focus; }
  a:hover { @apply underline brightness-110; }
  a:focus-visible { @apply ring-2 ring-offset-2 ring-primary-focus rounded-sm ring-offset-neutral-bg; }

  code, pre { font-family: var(--font-mono); @apply text-sm; }
  code:not(pre > code) {
    @apply px-1.5 py-0.5 bg-primary-50 text-primary-dark dark:bg-primary-900 dark:text-primary-light rounded-[var(--radius-sm)] text-xs font-semibold border border-primary-100 dark:border-primary-800;
  }
  pre {
    background-color: hsl(var(--neutral-hue-dark) calc(var(--neutral-saturation-dark) + 5%) 12%);
    color: hsl(var(--neutral-hue-dark) 25% 88%);
    @apply p-4 md:p-5 rounded-[var(--radius-lg)] shadow-lg overflow-x-auto my-6 leading-relaxed
           border border-neutral-border-dark;
    tab-size: 4;
    -webkit-font-smoothing: auto;
    -moz-osx-font-smoothing: auto;
  }
  .dark pre {
    background-color: hsl(var(--neutral-hue-dark) calc(var(--neutral-saturation-dark) + 2%) 8%);
    border-color: hsl(var(--neutral-hue-dark) 10% 18%);
  }

  ::-webkit-scrollbar { width: 10px; height: 10px; }
  ::-webkit-scrollbar-track { background-color: var(--scrollbar-track-bg); border-radius: var(--radius-sm); }
  ::-webkit-scrollbar-thumb {
    background-color: var(--scrollbar-thumb-bg);
    @apply rounded-full border-2 border-transparent bg-clip-content;
    transition: background-color var(--duration-quick) ease;
  }
  ::-webkit-scrollbar-thumb:hover { background-color: var(--scrollbar-thumb-hover-bg); }
  ::-webkit-scrollbar-corner { @apply bg-transparent; }
  * {
    scrollbar-width: thin;
    scrollbar-color: var(--scrollbar-thumb-bg) var(--scrollbar-track-bg);
  }

  :focus-visible {
    @apply outline-none ring-2 ring-offset-2 rounded-[var(--radius-sm)]
           ring-accent-focus
           ring-offset-neutral-bg;
  }
  .dark :focus-visible { @apply ring-accent-focus; }
}

/* --- Component Layer --- */
@layer components {
  .btn {
    @apply inline-flex items-center justify-center gap-x-2.5 px-6 py-3 rounded-[var(--radius-holo)]
           font-semibold text-base tracking-wide
           border border-transparent
           transition-all duration-[var(--duration-smooth)] ease-[var(--ease-elastic)]
           focus-visible:outline-none
           disabled:opacity-40 disabled:cursor-not-allowed disabled:saturate-50 disabled:transform-none disabled:shadow-none
           relative overflow-hidden select-none transform
           active:scale-[0.96] active:brightness-90 hover:scale-[1.03] hover:brightness-110; /* Use arbitrary value for scale */
    text-shadow: 0 1px 2px hsl(var(--shadow-color-hsl) / 0.2);
    will-change: transform, box-shadow, background, opacity;
  }

  /* REMOVED the conflicting .btn:hover rule. Specific button types handle their own hover shadows. */
  /* Base hover:scale and hover:brightness are in the @apply above. */

  .btn::before, .btn::after {
    content: '';
    @apply absolute inset-0 rounded-[inherit] transition-all duration-[var(--duration-slow)] ease-[var(--ease-out-expo)];
    pointer-events: none;
    z-index: 0;
  }

  /* MODIFIED SELECTOR HERE to avoid circular dependency with @apply btn in .btn-primary/.btn-accent */
  .btn-primary::before, .btn-accent::before {
    opacity: 0.7;
    padding: var(--border-width-thick);
    background: conic-gradient(from var(--angle), hsl(var(--holo-cyan-hsl)/0.8), hsl(var(--holo-magenta-hsl)/0.8), hsl(var(--holo-blue-hsl)/0.8), hsl(var(--holo-purple-hsl)/0.8), hsl(var(--holo-cyan-hsl)/0.8));
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    animation: holo-border-flow-anim 6s linear infinite;
    filter: blur(1px);
  }
  /* MODIFIED SELECTOR HERE to match above */
  .btn-primary:hover::before, .btn-accent:hover::before {
    opacity: 1;
    filter: blur(0.5px) brightness(1.2);
    animation-duration: 4s;
  }

  .btn-primary {
    @apply btn bg-primary-600 text-neutral-text-inverted shadow-holo-md;
    background-image: linear-gradient(145deg, hsl(var(--primary-light-hsl)/0.95), hsl(var(--primary-dark-hsl)/1.05));
  }
  .dark .btn-primary {
    @apply bg-primary-500 text-neutral-text-inverted;
    background-image: linear-gradient(145deg, hsl(var(--primary-light-hsl)), hsl(var(--primary-color-hsl)));
  }
  .btn-primary:hover { /* Specific hover shadow for btn-primary */
    box-shadow: var(--tw-shadow-holo-lg), 0 0 20px hsl(var(--primary-hue) var(--primary-saturation) var(--primary-lightness-base) / 0.4);
  }

  .btn-secondary {
    @apply btn bg-neutral-bg-surface text-neutral-text border-neutral-border shadow-interactive hover:shadow-interactive-hover hover:border-primary-focus/60;
  }
  .dark .btn-secondary {
    @apply hover:border-primary-focus/80 bg-neutral-bg-elevated border-neutral-border-dark;
  }

  .btn-accent {
    @apply btn bg-accent-500 text-neutral-text-inverted shadow-holo-md;
    background-image: linear-gradient(145deg, hsl(var(--accent-light-hsl)/0.95), hsl(var(--accent-dark-hsl)/1.05));
  }
  .dark .btn-accent { @apply bg-accent-500; }
  .btn-accent:hover { /* Specific hover shadow for btn-accent */
    box-shadow: var(--tw-shadow-holo-lg), 0 0 20px hsl(var(--accent-hue) var(--accent-saturation) var(--accent-lightness-base) / 0.4);
  }

  .btn-ghost {
    @apply btn text-primary-500 hover:bg-primary-500/10 shadow-none border-transparent;
    text-shadow: none;
  }
  .dark .btn-ghost { @apply text-primary-light hover:bg-primary-light/10; }

  .btn-danger {
    @apply btn bg-error-dark text-white shadow-lg hover:shadow-error/40;
    background-image: linear-gradient(145deg, hsl(var(--error-hue) var(--error-saturation) calc(var(--error-lightness) + 10%)), hsl(var(--error-hue) var(--error-saturation) calc(var(--error-lightness) - 10%)));
  }
  .dark .btn-danger { @apply bg-error; }

  .btn-xs { @apply px-3 py-1.5 text-xs rounded-[calc(var(--radius-holo)-0.4rem)] gap-x-1; }
  .btn-sm { @apply px-4 py-2 text-sm rounded-[calc(var(--radius-holo)-0.2rem)] gap-x-2; }
  .btn-lg { @apply px-8 py-4 text-lg rounded-[calc(var(--radius-holo)+0.2rem)] gap-x-3; }
  .btn-icon { @apply p-2.5 rounded-[var(--radius-holo)] aspect-square; }
  .btn-icon.btn-sm { @apply p-2; }

  .glass-pane {
    background: var(--glass-bg);
    backdrop-filter: blur(var(--glass-blur)) saturate(130%);
    -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(130%);
    border: 1px solid var(--glass-border);
    box-shadow: var(--glass-shadow), var(--tw-shadow-analog-inset);
    @apply rounded-[var(--radius-xl)] transition-all duration-[var(--duration-smooth)] ease-[var(--ease-out-quad)];
  }
  .glass-pane-interactive {
    @apply glass-pane hover:border-primary-focus/40 dark:hover:border-primary-focus/50 hover:shadow-holo-md;
  }
  .header-glass {
    background: hsl(var(--bg-base-hsl) / 0.75);
    backdrop-filter: blur(20px) saturate(150%);
    -webkit-backdrop-filter: blur(20px) saturate(150%);
    @apply rounded-none border-b border-neutral-border shadow-lg;
    transition: background-color var(--duration-smooth), border-color var(--duration-smooth);
  }
  .dark .header-glass {
    background: hsl(var(--bg-base-hsl-dark) / 0.8);
  }

  .card-base {
    @apply bg-neutral-bg-surface border border-neutral-border rounded-[var(--radius-xl)] shadow-xl
           dark:shadow-2xl dark:shadow-black/30
           transition-all duration-[var(--duration-smooth)] ease-[var(--ease-out-quad)];
    box-shadow: inset 0 1px 1px hsl(var(--bg-surface-hsl)/0.4),
                inset 0 -1px 1px hsl(var(--shadow-color-hsl)/0.03),
                0 12px 35px hsl(var(--shadow-color-hsl)/0.12),
                0 0 0 1px hsl(var(--border-interactive-hsl)/0);
  }
  .dark .card-base {
    box-shadow: inset 0 1px 0px hsl(var(--neutral-hue-dark) 10% 25% / 0.5),
                inset 0 -1px 1px hsl(var(--shadow-color-hsl)/0.1),
                0 15px 40px hsl(var(--shadow-color-hsl)/0.25),
                0 0 0 1px hsl(var(--border-interactive-hsl)/0);
  }
  .card-base-hover {
    @apply card-base hover:shadow-holo-lg hover:border-primary-focus/60 hover:scale-[1.015] hover:-translate-y-1.5;
  }
  .card-base-hover:hover {
    box-shadow: inset 0 1px 1px hsl(var(--bg-surface-hsl)/0.4),
                inset 0 -1px 1px hsl(var(--shadow-color-hsl)/0.03),
                0 12px 35px hsl(var(--shadow-color-hsl)/0.12),
                0 0 0 1px hsl(var(--border-interactive-hsl)/0.7);
  }
  .dark .card-base-hover:hover {
    box-shadow: inset 0 1px 0px hsl(var(--neutral-hue-dark) 10% 25% / 0.5),
                inset 0 -1px 1px hsl(var(--shadow-color-hsl)/0.1),
                0 15px 40px hsl(var(--shadow-color-hsl)/0.25),
                0 0 0 1px hsl(var(--border-interactive-hsl)/0.9);
  }
  .card-base-interactive { @apply card-base-hover cursor-pointer; }

  .form-input, .form-select, .form-textarea {
    @apply w-full block px-4 py-3.5 rounded-[var(--radius-md)] text-base
           bg-neutral-bg-subtle text-neutral-text border border-neutral-border-light
           transition-all duration-[var(--duration-smooth)] ease-[var(--ease-out-quad)]
           focus:outline-none focus:ring-2 focus:ring-accent-focus focus:border-accent-focus
           placeholder:text-neutral-text-placeholder;
    box-shadow: inset 0 2px 4px hsl(var(--shadow-color-hsl)/0.06), 0 1px 1px hsl(var(--shadow-color-hsl)/0.03);
  }
  .dark .form-input, .dark .form-select, .dark .form-textarea {
    @apply bg-neutral-bg-elevated border-neutral-border-dark/70 placeholder:text-neutral-text-placeholder;
    box-shadow: inset 0 2px 4px hsl(var(--shadow-color-hsl)/0.2), 0 1px 1px hsl(var(--shadow-color-hsl)/0.1);
  }
  .form-input:focus, .form-select:focus, .form-textarea:focus {
    @apply shadow-holo-sm bg-neutral-bg-surface;
  }
  .dark .form-input:focus, .dark .form-select:focus, .dark .form-textarea:focus {
    @apply bg-neutral-bg-elevated;
  }
  .form-select {
    @apply appearance-none pr-12 cursor-pointer bg-no-repeat;
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='hsl(var(--text-muted-hsl))' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
    background-position: right 1rem center;
    background-size: 1.2em 1.2em;
  }
  .dark .form-select {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='hsl(var(--text-muted-hsl-dark))' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
  }
  .form-textarea { @apply min-h-[120px] sm:min-h-[160px] resize-y leading-relaxed py-3; }

  .toggle-switch {
    @apply relative inline-flex h-7 w-12 items-center rounded-full cursor-pointer
           transition-colors duration-[var(--duration-smooth)] ease-in-out
           focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-offset-neutral-bg focus-within:ring-accent-focus;
  }
  .toggle-switch-track {
    @apply h-full w-full rounded-full bg-neutral-border-light dark:bg-neutral-border-dark/60
           peer-checked:bg-primary-500 dark:peer-checked:bg-primary-500 transition-colors;
    box-shadow: var(--tw-shadow-analog-inset);
  }
  .toggle-switch-knob {
    @apply absolute top-1 left-1 bg-white dark:bg-neutral-200 border border-neutral-border-light dark:border-transparent rounded-full h-5 w-5
           shadow-md transition-transform duration-[var(--duration-smooth)] ease-[var(--ease-elastic)]
           peer-checked:translate-x-full peer-checked:border-white dark:peer-checked:bg-white;
  }
  .dark .toggle-switch-knob { box-shadow: 0 1px 3px rgba(0,0,0,0.3); }

  .skip-link {
    @apply sr-only focus:not-sr-only focus:fixed focus:top-4 focus:left-4 focus:z-[99999]
           focus:px-4 focus:py-2.5 focus:rounded-[var(--radius-md)] focus:font-semibold
           focus:bg-accent-500 focus:text-neutral-text-inverted focus:shadow-holo-lg
           focus:animate-skip-link-focus;
    text-decoration: none;
  }

  .loading-overlay {
    @apply fixed inset-0 z-[500] flex flex-col items-center justify-center transition-opacity duration-[var(--duration-smooth)];
    background-color: hsl(var(--bg-base-hsl) / 0.85);
    backdrop-filter: blur(10px) saturate(110%);
    -webkit-backdrop-filter: blur(10px) saturate(110%);
  }
  .loading-animation { @apply text-center; }
  .loading-spinner {
    @apply relative w-16 h-16 mx-auto mb-6;
  }
  .spinner-blade {
    @apply absolute left-1/2 top-1/2 w-1.5 h-5 rounded-full
           origin-center opacity-0 animate-spinner-blade-fade;
    background-image: linear-gradient(hsl(var(--holo-cyan-hsl)), hsl(var(--holo-purple-hsl)));
    box-shadow: 0 0 5px hsl(var(--holo-cyan-hsl)/0.7);
  }
  .spinner-blade:nth-child(1) { transform: rotate(0deg) translateY(-1.5rem); animation-delay: -0.9s; }
  .spinner-blade:nth-child(2) { transform: rotate(45deg) translateY(-1.5rem); animation-delay: -0.8s; }
  .spinner-blade:nth-child(3) { transform: rotate(90deg) translateY(-1.5rem); animation-delay: -0.7s; }
  .spinner-blade:nth-child(4) { transform: rotate(135deg) translateY(-1.5rem); animation-delay: -0.6s; }
  .spinner-blade:nth-child(5) { transform: rotate(180deg) translateY(-1.5rem); animation-delay: -0.5s; }
  .spinner-blade:nth-child(6) { transform: rotate(225deg) translateY(-1.5rem); animation-delay: -0.4s; }
  .spinner-blade:nth-child(7) { transform: rotate(270deg) translateY(-1.5rem); animation-delay: -0.3s; }
  .spinner-blade:nth-child(8) { transform: rotate(315deg) translateY(-1.5rem); animation-delay: -0.2s; }

  .loading-text {
    @apply text-lg font-display font-semibold text-neutral-text-secondary tracking-wider animate-pulse-subtle;
    text-shadow: 0 0 5px hsl(var(--accent-color-hsl)/0.3);
  }

  .toast-notifications-container {
    @apply fixed bottom-0 right-0 sm:bottom-auto sm:top-4 sm:right-4 p-4 sm:p-6 w-full sm:max-w-md z-[600] space-y-4;
  }
  .toast-notification {
    @apply flex items-start p-4 rounded-[var(--radius-lg)] shadow-2xl border relative overflow-hidden glass-pane;
    border-left-width: 4px;
    transition: all var(--duration-smooth) var(--ease-out-expo);
  }
  .toast--success { @apply border-l-success-500; }
  .dark .toast--success { @apply border-l-success-light; }
  .toast--error { @apply border-l-error-500; }
  .dark .toast--error { @apply border-l-error-light; }
  .toast--warning { @apply border-l-warning-500; }
  .dark .toast--warning { @apply border-l-warning-light; }
  .toast--info { @apply border-l-info-500; }
  .dark .toast--info { @apply border-l-info-light; }

  .toast__icon-wrapper { @apply shrink-0 mr-3; }
  .toast__icon { @apply w-6 h-6; }
  .toast--success .toast__icon { @apply text-success-500; }
  .dark .toast--success .toast__icon { @apply text-success-light; }
  .toast--error .toast__icon { @apply text-error-500; }
  .dark .toast--error .toast__icon { @apply text-error-light; }
  .toast--warning .toast__icon { @apply text-warning-500; }
  .dark .toast--warning .toast__icon { @apply text-warning-light; }
  .toast--info .toast__icon { @apply text-info-500; }
  .dark .toast--info .toast__icon { @apply text-info-light; }

  .toast__content { @apply flex-grow; }
  .toast__title { @apply font-semibold text-neutral-text; }
  .toast__message { @apply text-sm text-neutral-text-secondary mt-0.5; }
  .toast__close-button {
    @apply absolute top-2 right-2 p-1.5 rounded-full text-neutral-text-muted hover:bg-neutral-bg-elevated hover:text-neutral-text
           transition-colors duration-[var(--duration-quick)] focus-visible:ring-1 focus-visible:ring-accent-focus;
  }
  .toast__close-icon { @apply w-4 h-4; }

  .toast-transition-enter-active,
  .toast-transition-leave-active {
    transition: all var(--duration-smooth) var(--ease-out-expo);
  }
  .toast-transition-enter-from,
  .toast-transition-leave-to {
    opacity: 0;
    transform: scale(0.9) translateY(20px);
  }
  .toast-transition-move {
    transition: transform var(--duration-smooth) var(--ease-out-expo);
  }

  .message-bubble {
    @apply p-3 sm:p-4 rounded-[var(--radius-lg)] shadow-md max-w-[85%] md:max-w-[75%] break-words;
    transition: background-color var(--duration-smooth), box-shadow var(--duration-smooth);
  }
  .message-bubble-user {
    @apply bg-primary-500 text-white ml-auto rounded-br-sm;
  }
  .dark .message-bubble-user { @apply bg-primary-600; }
  .message-bubble-assistant {
    @apply bg-neutral-bg-surface text-neutral-text border border-neutral-border mr-auto rounded-bl-sm;
    box-shadow: var(--tw-shadow-analog-outset);
  }
  .dark .message-bubble-assistant { @apply bg-neutral-bg-elevated border-neutral-border-dark; }
  .message-bubble .prose { @apply text-sm sm:text-base; }
  .message-bubble .prose p:last-child { @apply mb-0; }
}

/* --- Utility Layer --- */
@layer utilities {
  .text-balance { text-wrap: balance; }
  .text-pretty { text-wrap: pretty; }

  /* Keyframes for indicators are now defined in tailwind.config.js */
  /* .transition-default, .text-glow-*, .icon-* utilities are now in tailwind.config.js plugins */

  @keyframes holo-grid-scroll-anim {
    0% { background-position: 0 0; }
    100% { background-position: -1200px -1200px; }
  }

  .analog-scanlines::before {
    content: "";
    @apply absolute inset-0 pointer-events-none z-10 opacity-15 dark:opacity-10;
    background-image: linear-gradient(transparent 50%, hsl(var(--bg-base-hsl)/0.3) 50%);
    background-size: 100% 3px;
    animation: analog-scan-anim 15s linear infinite;
  }
  .dark .analog-scanlines::before {
    background-image: linear-gradient(transparent 50%, hsl(var(--bg-base-hsl-dark)/0.3) 50%);
  }
}

/* --- Responsive Styles --- */
@media (min-width:568px) and (orientation:landscape) {}
@media (min-width:768px) {
  .message-bubble {
    @apply max-w-[75%] p-4 sm:p-5 text-base;
  }
}
@media (min-width:1024px) {
  .message-bubble {
    @apply max-w-[70%] p-5 sm:p-6;
  }
}
@media (min-width:1280px) {}
@media (min-width:1536px) {
  .message-bubble {
    @apply max-w-[65%];
  }
}

/* --- Accessibility Overrides & Enhancements --- */
@media (prefers-reduced-motion: reduce) {
  html { scroll-behavior: auto !important; }
  *, *::before, *::after {
    animation-duration: 0.001ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.001ms !important;
    transition-delay: 0ms !important;
    animation-play-state: paused !important;
  }
  .animated-gradient-bg, .animated-holo-grid, .analog-scanlines::before, .btn::before, .btn::after, .loading-spinner, .spinner-blade {
    animation: none !important;
  }
  .btn { transition: background-color var(--duration-quick), border-color var(--duration-quick), color var(--duration-quick), opacity var(--duration-quick); }
}

@media (prefers-contrast: more) {
  .glass-pane, .card-base, .header-glass {
    background: hsl(var(--bg-base-hsl)) !important;
    border: var(--border-width-thick) solid hsl(var(--text-primary-hsl)) !important;
    backdrop-filter: none !important;
    box-shadow: none !important;
  }
  .btn {
    @apply border-2 !important;
    border-color: currentColor !important;
    background-image: none !important;
    background-color: hsl(var(--bg-base-hsl)) !important;
    color: hsl(var(--text-primary-hsl)) !important;
    text-shadow: none !important; box-shadow: none !important;
  }
  .btn::before, .btn::after { display: none !important; }
  .form-input, .form-select, .form-textarea {
    border-width: var(--border-width-thick);
    border-color: hsl(var(--text-primary-hsl));
  }
}

/* Print Styles */
@media print {
  body { background: #fff !important; color: #000 !important; font-size: 10pt; }
  .app-header, .app-footer, .voice-input-section, .btn,
  .toast-notifications-container, .skip-link, [data-no-print="true"],
  .private-home-wrapper .orbit-container
  {
    display: none !important;
  }
  .glass-pane, .card-base, .header-glass {
    background: #fff !important; border: 1px solid #ccc !important; box-shadow: none !important;
    print-color-adjust: exact; -webkit-print-color-adjust: exact;
  }
  .message-bubble { border: 1px solid #ddd !important; background-color: #f9f9f9 !important; }
  .message-bubble-user { background-color: #e1f5fe !important; }
  a { text-decoration: underline !important; color: #000 !important; }
  pre { background-color: #f0f0f0 !important; border: 1px solid #ccc !important; color: #333 !important; white-space: pre-wrap !important; word-wrap: break-word !important;}
}