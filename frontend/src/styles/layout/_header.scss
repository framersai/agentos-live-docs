// File: frontend/src/styles/layout/_header.scss
/**
 * @file _header.scss
 * @description Styles for the main application header, "Ephemeral Harmony" theme.
 * Features glassmorphism, holographic accents, themed controls, dynamic activity indicators,
 * and integrates the new UserSettingsDropdown and VoiceControlsDropdown.
 * @version 3.0.0
 */

@use '../abstracts/variables' as var;
@use '../abstracts/mixins' as mixins;
@use '../components/buttons' as buttonsFile; // For potential direct use or reference

.app-header-ephemeral {
  height: var(--header-height, 64px);
  padding: 0 var.$spacing-md; // Main horizontal padding
  display: flex;
  align-items: center;
  justify-content: center; // Center the content wrapper
  position: sticky;
  top: 0;
  z-index: var.$z-index-sticky;

  @include mixins.glassmorphic-pane(
    hsla(var(--color-bg-primary-h), var(--color-bg-primary-s), var(--color-bg-primary-l), 0.45), // More transparent for header
    hsla(var(--color-border-glass-h), var(--color-border-glass-s), var(--color-border-glass-l), 0.2), // Softer border
    calc(var(--blur-glass) * 1.1), // Slightly more blur for header distinctness
    var(--shadow-depth-sm)
  );
  border-bottom: 1px solid hsla(var(--color-border-glass-h), var(--color-border-glass-s), var(--color-border-glass-l), 0.2);
  transition: all var.$duration-smooth var.$ease-out-quad; // For theme changes and active states

  &.ai-speaking-active { // Class from App.vue
    border-bottom-color: hsla(var(--color-voice-ai-speaking-h), var(--color-voice-ai-speaking-s), var(--color-voice-ai-speaking-l), 0.7);
    box-shadow: var(--shadow-depth-sm),
                0 0 25px 5px hsla(var(--color-voice-ai-speaking-h), var(--color-voice-ai-speaking-s), var(--color-voice-ai-speaking-l), 0.35),
                inset 0 -2px 5px hsla(var(--color-voice-ai-speaking-h), var(--color-voice-ai-speaking-s), var(--color-voice-ai-speaking-l), 0.1); // Inner glow from bottom
  }
  &.user-listening-active { // Class from App.vue
     border-bottom-color: hsla(var(--color-voice-user-h), var(--color-voice-user-s), var(--color-voice-user-l), 0.7);
     box-shadow: var(--shadow-depth-sm),
                 0 0 25px 5px hsla(var(--color-voice-user-h), var(--color-voice-user-s), var(--color-voice-user-l), 0.35),
                 inset 0 -2px 5px hsla(var(--color-voice-user-h), var(--color-voice-user-s), var(--color-voice-user-l), 0.1);
  }
}

.header-content-wrapper-ephemeral {
  width: 100%;
  max-width: var.$site-max-width;
  margin: 0 auto;
  padding: 0 var.$spacing-xs; // Reduced inner padding for more space
  display: grid; // Using grid for more structured layout
  grid-template-columns: auto 1fr auto; // Logo | Center (Hearing Icon) | Controls
  align-items: center;
  height: 100%;
  gap: var.$spacing-md;

  @media (max-width: var.$breakpoint-md) {
    grid-template-columns: auto 1fr; // Logo | Controls (Hearing icon might hide or move to controls)
    .header-center-section { display: none; } // Hide hearing icon on medium and down by default
  }
  @media (max-width: var.$breakpoint-sm) {
     gap: var.$spacing-sm; // Tighter gap on small screens
  }
}

.header-left-section {
  display: flex;
  align-items: center;
  justify-self: start; // Align to the start of its grid area
}

.logo-title-link-ephemeral {
  display: inline-flex;
  align-items: center;
  gap: var.$spacing-sm;
  text-decoration: none;
  color: hsl(var(--color-text-primary-h), var(--color-text-primary-s), var(--color-text-primary-l));
  transition: filter 0.3s var.$ease-out-quad;

  &:hover, &:focus-visible {
    filter: brightness(1.1);
    .app-logo-ephemeral {
      transform: scale(1.12) rotate(12deg);
      filter: drop-shadow(0 0 12px hsla(var(--color-accent-primary-h), var(--color-accent-primary-s), var(--color-accent-primary-l), 0.8));
    }
    .app-title-ephemeral {
       @include mixins.text-glow('--color-accent-primary', 7px, 0.9);
    }
  }
  &:focus-visible {
    outline: none;
    border-radius: var.$radius-sm; // For focus ring visibility
    @include mixins.focus-ring('--color-bg-primary', '--color-accent-primary', 1px, 2px, 0.9);
  }
}

.app-logo-ephemeral {
  width: 36px;
  height: 36px;
  transition: transform 0.4s var.$ease-elastic, filter 0.3s var.$ease-out-quad;
  filter: drop-shadow(0 0 8px hsla(var(--color-accent-primary-h), var(--color-accent-primary-s), var(--color-accent-primary-l), 0.6));
  // The SVG animation itself is preserved.
}

.app-title-ephemeral {
  font-family: var(--font-family-display, var.$font-family-display);
  font-size: clamp(1.1rem, 0.9rem + 0.6vw, 1.35rem); // Responsive title
  line-height: 1;
  letter-spacing: 0.01em;
  white-space: nowrap; // Prevent title wrapping if possible
  @include mixins.text-glow('--color-accent-primary', 6px, 0.7);
  transition: text-shadow 0.3s var.$ease-out-quad;
  .font-light { opacity: 0.75; font-weight: 300; } // Style the "Assistant" part
}

.header-center-section {
  justify-self: center; // Center in its grid area
}

.hearing-icon-wrapper-ephemeral {
  width: 40px; // Standardized size
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var.$radius-full;
  transition: all var.$duration-smooth var.$ease-out-quad;
  position: relative; // For pseudo-element glows

  // Base animated glow for idle state
  &::before {
    content: '';
    position: absolute;
    inset: -3px;
    border-radius: inherit;
    background: conic-gradient(
      from 0deg,
      hsla(var(--color-accent-secondary-h), var(--color-accent-secondary-s), var(--color-accent-secondary-l), 0.1),
      hsla(var(--color-accent-secondary-h), var(--color-accent-secondary-s), var(--color-accent-secondary-l), 0.05),
      hsla(var(--color-accent-secondary-h), var(--color-accent-secondary-s), var(--color-accent-secondary-l), 0.1)
    );
    animation: spin 8s linear infinite; // Slow spin for subtle ambient glow
    z-index: -1;
    opacity: 0.7;
  }


  .hearing-icon-svg {
    width: 90%; // SVG fills most of the wrapper
    height: 90%;
    opacity: 0.6;
    transition: opacity 0.3s, transform 0.3s var.$ease-out-quad;
    // The SVG internal animations provide the "breathing"
  }

  &.idle {
    .hearing-icon-svg { opacity: 0.4; transform: scale(0.95); }
     &::before { opacity: 0.5; animation-duration: 12s; }
  }

  &.listening { // User is speaking
    background-color: hsla(var(--color-voice-user-h), var(--color-voice-user-s), var(--color-voice-user-l), 0.1);
    &::before { // Brighter, more active glow
      background: conic-gradient(
        from 0deg,
        hsla(var(--color-voice-user-h), var(--color-voice-user-s), var(--color-voice-user-l), 0.3),
        hsla(var(--color-voice-user-h), var(--color-voice-user-s), calc(var(--color-voice-user-l) + 10%), 0.15),
        hsla(var(--color-voice-user-h), var(--color-voice-user-s), var(--color-voice-user-l), 0.3)
      );
      animation-duration: 3s; // Faster spin
      opacity: 1;
      inset: -4px; // Larger glow effect
    }
    .hearing-icon-svg { opacity: 1; transform: scale(1.05); }
  }
  &.speaking { // AI is speaking
    background-color: hsla(var(--color-voice-ai-speaking-h), var(--color-voice-ai-speaking-s), var(--color-voice-ai-speaking-l), 0.1);
     &::before {
      background: conic-gradient(
        from 0deg,
        hsla(var(--color-voice-ai-speaking-h), var(--color-voice-ai-speaking-s), var(--color-voice-ai-speaking-l), 0.35),
        hsla(var(--color-voice-ai-speaking-h), var(--color-voice-ai-speaking-s), calc(var(--color-voice-ai-speaking-l) + 10%), 0.2),
        hsla(var(--color-voice-ai-speaking-h), var(--color-voice-ai-speaking-s), var(--color-voice-ai-speaking-l), 0.35)
      );
      animation-duration: 2.5s;
      opacity: 1;
      inset: -5px;
    }
    .hearing-icon-svg { opacity: 1; transform: scale(1); }
  }
}

.header-right-section {
  display: flex;
  align-items: center;
  gap: var.$spacing-sm; // Default gap for items in this section
  justify-self: end; // Align to the end of its grid area

  @media (min-width: var.$breakpoint-md) {
    gap: var.$spacing-md; // More space on larger screens
  }
}

.desktop-quick-nav-ephemeral {
  display: flex; // Shown by default, hidden by Tailwind classes on smaller screens if Header.vue uses md:flex
  align-items: center;
  gap: var.$spacing-xs;
}

// VoiceControlsDropdown styles are now in its own SCSS file.
// The trigger button for it can inherit from .nav-button-ephemeral or have specific styling here.
// Example if VoiceControlsDropdown trigger needs unique styling:
:deep(.vcd__trigger) { // Targeting the trigger from VoiceControlsDropdown.vue
  // @include buttonsFile.btn-secondary; // Or a different base
  // Override padding, font-size etc. if needed
  // padding: calc(var.$spacing-xs * 1.5) var.$spacing-sm !important;
  // font-size: var.$font-size-sm !important;
  // color: hsl(var(--color-text-secondary-h), var(--color-text-secondary-s), var(--color-text-secondary-l));
  // &:hover {
  //   color: hsl(var(--color-accent-interactive-h), var(--color-accent-interactive-s), var(--color-accent-interactive-l));
  //   background-color: hsla(var(--color-accent-interactive-h), var(--color-accent-interactive-s), var(--color-accent-interactive-l), 0.08);
  // }
}


.session-cost-display-ephemeral {
  padding: calc(var.$spacing-xs + 1px) var.$spacing-sm;
  border-radius: var.$radius-md;
  font-family: var(--font-mono, var.$font-family-mono);
  font-size: var.$font-size-xs;
  color: hsl(var(--color-text-secondary-h), var(--color-text-secondary-s), var(--color-text-secondary-l));
  background-color: hsla(var(--color-bg-tertiary-h), var(--color-bg-tertiary-s), var(--color-bg-tertiary-l), 0.5);
  border: 1px solid hsla(var(--color-border-secondary-h), var(--color-border-secondary-s), var(--color-border-secondary-l), 0.4);
  min-width: 75px; // Ensure it has some width
  text-align: right;
  white-space: nowrap;
  transition: all var.$duration-quick;
  @include mixins.text-glow('--color-accent-secondary', 3px, 0.3); // Subtle glow

  .cost-value {
    font-weight: 600;
    color: hsl(var(--color-accent-secondary-h), var(--color-accent-secondary-s), var(--color-accent-secondary-l));
  }
   &:hover {
    background-color: hsla(var(--color-bg-tertiary-h), var(--color-bg-tertiary-s), var(--color-bg-tertiary-l), 0.7);
    border-color: hsla(var(--color-accent-secondary-h), var(--color-accent-secondary-s), var(--color-accent-secondary-l), 0.5);
  }
}

// UserSettingsDropdown trigger (if not styled sufficiently by its own component)
:deep(.user-settings-trigger-button) {
  // Example of additional styling if needed
  // color: hsl(var(--color-text-primary-h), var(--color-text-primary-s), var(--color-text-primary-l));
  // &:hover {
  //   background-color: hsla(var(--color-bg-tertiary-h), var(--color-bg-tertiary-s), var(--color-bg-tertiary-l), 0.8);
  // }
}

// Fallback for mobile nav toggle if needed (though likely handled by UserSettingsDropdown internally now or Tailwind)
// .mobile-nav-toggle-ephemeral { /* ... */ }

// General structure for dropdown menus in header (if not handled by UserSettingsDropdown styles)
.dropdown-menu-ephemeral { /* This was from original Header.vue SCSS, likely UserSettingsDropdown.vue handles its own menu */ }
.dropdown-header-ephemeral { /* ... */ }
.dropdown-title-ephemeral { /* ... */ }
// ... other generic dropdown item styles might be centralized or per-dropdown component ...