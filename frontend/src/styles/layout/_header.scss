// File: frontend/src/styles/layout/_header.scss
/**
 * @file _header.scss
 * @description Fully Revamped Styles for the Header.vue component.
 * Implements "Ephemeral Harmony" aesthetics, responsiveness, direct controls,
 * mobile navigation, animated logo, reactive agent title, and enhanced effects.
 * @version 6.0.0 - Full Header Revamp.
 */

@use '../abstracts/variables' as var;
@use '../abstracts/mixins' as mixins;
@use '../components/buttons' as buttonsFile;
@use '../components/dropdowns' as dropdownsFile;

.app-header-ephemeral {
  --header-actual-height: 68px; // Standard height
  --header-padding-x: #{var.$spacing-md};
  --header-bg-alpha: 0.8; // Base alpha for header glass
  --header-blur: #{calc(var.$default-blur-glass + 2px)};

  @media (max-width: var.$breakpoint-sm) {
    --header-actual-height: 60px; // Slimmer on mobile
    --header-padding-x: #{var.$spacing-sm};
  }

  height: var(--header-actual-height);
  padding: 0 var(--header-padding-x);
  display: flex;
  align-items: center;
  justify-content: center;
  position: sticky;
  top: 0;
  z-index: var.$z-index-sticky + 10; // High z-index

  background-color: hsla(var(--color-bg-primary-h), var(--color-bg-primary-s), var(--color-bg-primary-l), var(--header-bg-alpha));
  backdrop-filter: blur(var(--header-blur));
  -webkit-backdrop-filter: blur(var(--header-blur));
  border-bottom: 1px solid hsla(var(--color-border-primary-h), var(--color-border-primary-s), var(--color-border-primary-l), 0.15);
  box-shadow: var(--shadow-depth-md); // Base shadow for depth
  transition: background-color var.$duration-smooth var.$ease-out-quad,
              border-bottom-color var.$duration-smooth var.$ease-out-quad,
              box-shadow var.$duration-smooth var.$ease-out-quad;
  
  // Reactive overlay for dynamic background effects
  &::before {
    content: '';
    position: absolute;
    inset: -1px; // Slight outset to cover border for glow effects
    background: transparent;
    opacity: 0;
    transition: opacity var.$duration-smooth ease-in-out, background var.$duration-smooth ease-in-out;
    z-index: -1;
    pointer-events: none;
    animation: none;
    border-radius: inherit;
  }

  &.ai-speaking-active {
    border-bottom-color: hsla(var(--color-voice-ai-speaking-h), var(--color-voice-ai-speaking-s), var(--color-voice-ai-speaking-l), 0.5);
    &::before {
      opacity: 1;
      background: radial-gradient(ellipse at 50% 120%, hsla(var(--color-voice-ai-speaking-h), var(--color-voice-ai-speaking-s), var(--color-voice-ai-speaking-l), 0.15) 0%, transparent 65%);
      animation: headerPulse var.$duration-pulse-medium * 0.75 infinite alternate;
    }
  }
  &.user-listening-active {
    border-bottom-color: hsla(var(--color-voice-user-h), var(--color-voice-user-s), var(--color-voice-user-l), 0.5);
     &::before {
      opacity: 1;
      background: radial-gradient(ellipse at 50% 120%, hsla(var(--color-voice-user-h), var(--color-voice-user-s), var(--color-voice-user-l), 0.12) 0%, transparent 65%);
      animation: headerPulse var.$duration-pulse-medium * 0.9 infinite alternate;
    }
  }
}

.header-content-wrapper-ephemeral {
  width: 100%;
  max-width: var.$site-max-width;
  margin: 0 auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
  height: 100%;
}

// --- Left Section: Logo & Agent Info ---
.header-left-section {
  display: flex;
  align-items: center;
  flex-shrink: 0; // Prevent undue shrinking
  gap: var.$spacing-sm; // Space between logo and agent title display

  .animated-logo-link { // Clickable area for the logo
    display: inline-block; // To allow padding
    padding: var.$spacing-xs * 0.5;
    margin: calc(var.$spacing-xs * -0.5); // Negative margin to keep visual alignment
    border-radius: var.$radius-sm;
    transition: background-color var.$duration-quick;
    &:hover {
      background-color: hsla(var(--color-bg-tertiary-h), var(--color-bg-tertiary-s), var(--color-bg-tertiary-l), 0.15);
    }
    &:focus-visible {
      @include mixins.focus-ring('--color-bg-primary', '--color-accent-interactive', 0px, 2px);
    }
  }
}

.current-agent-display-header {
  display: flex;
  align-items: center;
  gap: var.$spacing-xs;
  padding: calc(var.$spacing-xs * 0.5) var.$spacing-sm;
  border-radius: var.$radius-md;
  background-color: hsla(var(--color-bg-secondary-h), var(--color-bg-secondary-s), var(--color-bg-secondary-l), 0.1);
  border: 1px solid hsla(var(--color-border-primary-h), var(--color-border-primary-s), var(--color-border-primary-l), 0.08);
  max-width: 200px; // Initial max-width, adjust with media queries

  .agent-icon-header {
    width: 20px; height: 20px;
    flex-shrink: 0;
    opacity: 0.8;
    // Color can be set by agent.iconClass or themed default
    color: hsl(var(--color-text-muted-h), var(--color-text-muted-s), var(--color-text-muted-l));
  }
  .agent-name-header {
    font-size: var.$font-size-sm;
    font-weight: 500;
    color: hsl(var(--color-text-primary-h), var(--color-text-primary-s), var(--color-text-primary-l));
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    animation: subtleGlimmer 4.5s ease-in-out infinite alternate; // Slower, more subtle
  }

  @media (max-width: var.$breakpoint-lg) { // Hide/simplify on medium screens
    display: none; // Or show only icon
  }
}


// --- Center Section: Hearing Icon ---
.header-center-section {
  display: flex;
  align-items: center;
  justify-content: center;
  flex-grow: 1; // Takes up space to center the hearing icon relative to overall header
  // On smaller screens, this might get squeezed. The hearing icon can be moved.
  @media (max-width: #{var.$breakpoint-md - 1px}) { // Below medium
    position: absolute; // Allow it to center properly without affecting flexbox of left/right
    left: 50%;
    transform: translateX(-50%);
    pointer-events: none; // So it doesn't interfere with mobile trigger
    .hearing-icon-wrapper-ephemeral { pointer-events: auto; } // Allow click on icon itself if interactive
  }
}

.hearing-icon-wrapper-ephemeral { /* Base styles from v4.1.1 are good */
  // Further enhance reactivity
  transition: all var.$duration-smooth var.$ease-out-quad, box-shadow var.$duration-smooth, transform 0.4s var.$ease-elastic;
   &.listening, &.speaking {
    transform: scale(1.1); // Make it slightly larger when active
    &::before { // Stronger pulse effect from v4.1.1 is good
        animation-duration: 1.2s !important;
        --scale-pulse: 1.35 !important;
        --opacity-pulse: 1 !important;
        inset: -6px !important; // Wider glow
    }
  }
}

// --- Right Section: Desktop Controls & Mobile Trigger ---
.header-right-section { // Common wrapper for desktop controls and mobile trigger placeholder
  display: flex;
  align-items: center;
  gap: var.$spacing-xs;
  justify-content: flex-end;
}

.desktop-controls-ephemeral { // Shown on lg+
  display: none; // Hidden by default, shown by media query
  align-items: center;
  gap: var.$spacing-xs;
  @media (min-width: var.$breakpoint-lg) { display: flex; }
  @media (min-width: var.$breakpoint-xl) { gap: var.$spacing-sm; }

  .header-control-item { display: flex; align-items: center; }
}

// Shared styling for direct icon buttons in the header
.direct-header-button,
.header-control-item > .btn-ghost-ephemeral.btn-icon-ephemeral, // Targets dropdown triggers
:deep(.agent-hub-trigger-button) { // Target button inside AgentHubTrigger
  @include buttonsFile.btn-ghost;
  @include buttonsFile.btn-icon-modifier; // Makes it suitable for icon-only
  padding: var.$spacing-sm !important;
  border-radius: var.$radius-md !important;
  color: hsl(var(--color-text-secondary-h),var(--color-text-secondary-s),var(--color-text-secondary-l), 0.9);
  border: 1px solid transparent; // Base for focus ring offset

  .icon-base { width: 1.3rem; height: 1.3rem; opacity: 0.75; transition: transform 0.2s, color 0.2s; }
  .icon-xs { width: 0.9rem; height: 0.9rem; transition: transform 0.2s, color 0.2s; opacity: 0.7;}


  &:hover, &:focus-visible, &[aria-expanded="true"] {
    background-color: hsla(var(--color-accent-interactive-h), var(--color-accent-interactive-s), var(--color-accent-interactive-l), 0.15) !important;
    color: hsl(var(--color-accent-interactive-h), var(--color-accent-interactive-s), var(--color-accent-interactive-l)) !important;
    border-color: hsla(var(--color-accent-interactive-h), var(--color-accent-interactive-s), var(--color-accent-interactive-l), 0.25);
    .icon-base, .icon-xs { transform: scale(1.12); opacity: 1; }
  }
  &:focus-visible {
    @include mixins.focus-ring('--color-bg-primary', '--color-accent-interactive', 0px, 2px, 0.8);
  }
}

.direct-link-ephemeral { // For About/Settings text links on desktop
  .link-text-ephemeral {
    font-size: var.$font-size-xs;
    font-weight: 500;
    margin-left: var.$spacing-xs * 0.75;
    letter-spacing: 0.01em;
    @media (max-width: calc(var.$breakpoint-xl - 1px)) { display: none; }
  }
}


// --- Mobile Navigation ---
.mobile-menu-trigger-wrapper-ephemeral {
  display: none;
  @media (max-width: calc(var.$breakpoint-lg - 1px)) {
    display: flex;
    align-items: center;
    gap: var.$spacing-xs; // Space between agent hub trigger and hamburger on mobile
  }
}
.mobile-menu-trigger-button {
  // Uses .btn .btn-ghost-ephemeral .btn-icon-ephemeral from above common style
  padding: var.$spacing-sm !important;
  .icon-base { width: 2rem; height: 2rem; } // Larger hamburger
}
.mobile-agent-hub-trigger { // If AgentHubTrigger is used in mobile header bar
    // Styles inherited from .direct-header-button or .header-control-item > button
    // Make icon slightly smaller if needed for mobile bar
    :deep(.icon-base) { width: 1.5rem; height: 1.5rem; }
    :deep(.trigger-text-ephemeral) { display: none; } // No text on mobile bar
}


.mobile-nav-panel-ephemeral {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  @include mixins.glassmorphic-pane(
    '--color-bg-primary', '--color-border-primary', calc(var(--blur-glass) * 2), 'none',
    var.$default-color-bg-primary-h, var.$default-color-bg-primary-s, var.$default-color-bg-primary-l, 0.985, // Highly opaque
    var.$default-color-border-primary-h, var.$default-color-border-primary-s, var.$default-color-border-primary-l, 0.2,
    calc(var.$default-blur-glass * 2)
  );
  z-index: var.$z-index-sticky + 15; // High, but below potential global modals like AgentHub
  display: flex;
  flex-direction: column;
  padding: 0;
  box-shadow: var.$shadow-depth-xl; // Add shadow to pop it out

  .mobile-nav-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 var.$spacing-md;
    height: var(--header-actual-height); // Match main header height
    border-bottom: 1px solid hsla(var(--color-border-primary-h),var(--color-border-primary-s),var(--color-border-primary-l), 0.1);
    flex-shrink: 0;

    .mobile-nav-logo :deep(.animated-logo-ephemeral) {
      gap: var.$spacing-xs;
      .logo-img-animated { width: 26px; height: 26px;}
      .title-text-animated { font-size: var.$font-size-base-default * 1.1; }
      .app-name-main { color: hsl(var(--color-logo-primary-h,var(--color-accent-primary-h))); }
      .app-name-subtitle { display: none; } // Keep it compact
    }
    .mobile-nav-close-button {
      @include buttonsFile.btn-ghost; @include buttonsFile.btn-icon-modifier;
      padding: var.$spacing-sm !important;
      .icon-base { width: 1.75rem; height: 1.75rem; }
    }
  }

  .mobile-nav-content-ephemeral {
    padding: var.$spacing-md; // Reduced padding for mobile nav items
    flex-grow: 1;
    overflow-y: auto;
    @include mixins.custom-scrollbar('--color-accent-interactive', 0.4, 0.6, '--color-bg-secondary', 0.1, 5px);
  }

  .mobile-nav-agent-title {
    font-size: var.$font-size-sm; font-weight: 500;
    color: hsl(var(--color-text-muted-h),var(--color-text-muted-s),var(--color-text-muted-l));
    padding: var.$spacing-xs var.$spacing-sm; margin-bottom: var.$spacing-sm; text-align: center;
    background-color: hsla(var(--color-bg-secondary-h),var(--color-bg-secondary-s),var(--color-bg-secondary-l),0.15);
    border-radius: var.$radius-sm; display: flex; align-items: center; justify-content: center; gap: var.$spacing-xs;
    .agent-icon-mobile-nav { width: 1.25rem; height: 1.25rem; opacity: 0.8;}
  }

  .mobile-nav-item {
    @include dropdownsFile.dropdown-item-ephemeral;
    font-size: var.$font-size-base-default * 1.1 !important; // Larger for touch
    padding: var.$spacing-md var.$spacing-md !important;
    border-radius: var.$radius-lg !important;
    &.prominent-action { // For "Explore Assistants"
        @include buttonsFile.btn-secondary; // Make it look like a secondary button
        justify-content: center !important;
        margin-bottom: var.$spacing-sm;
        color: hsl(var(--color-text-primary-h),var(--color-text-primary-s),var(--color-text-primary-l)) !important;
        &:hover {
            color: hsl(var(--color-accent-interactive-h),var(--color-accent-interactive-s),var(--color-accent-interactive-l)) !important;
        }
    }
    .nav-item-icon { width: 1.5rem; height: 1.5rem; margin-right: var.$spacing-md;}
  }
  .mobile-nav-divider { @include dropdownsFile.dropdown-divider-ephemeral; margin: var.$spacing-md 0; }
  .mobile-nav-section-title { @include dropdownsFile.dropdown-section-title-ephemeral; font-size: var.$font-size-xs; padding-left: var.$spacing-sm; }
  
  .theme-selector-grid-mobile {
    display: flex; flex-direction: column; gap: var.$spacing-xs; margin: var.$spacing-xs 0;
    .theme-button-mobile { /* Uses .mobile-nav-item base */
        font-size: var.$font-size-base-default * 0.95 !important;
        .mini-icon { width: 1rem; height: 1rem; margin-right: var.$spacing-sm; }
        .checkmark-icon-mobile { margin-left:auto; width:1rem; height:1rem; }
    }
  }
}

.mobile-nav-slide-from-right-enter-active,
.mobile-nav-slide-from-right-leave-active {
  transition: transform 0.35s var.$ease-out-expo, opacity 0.3s var.$ease-out-quad;
}
.mobile-nav-slide-from-right-enter-from,
.mobile-nav-slide-from-right-leave-to {
  transform: translateX(100%);
  opacity: 0.7;
}