// File: frontend/src/styles/layout/_header.scss
/**
 * @file _header.scss
 * @description Styles for the main application header, "Ephemeral Harmony" theme.
 * Features glassmorphism, holographic accents, themed controls, dynamic activity indicators,
 * agent title display, and integrates new dropdown styles.
 * @version 3.1.0
 */

@use '../abstracts/variables' as var;
@use '../abstracts/mixins' as mixins;
@use '../components/buttons' as buttonsFile;

.app-header-ephemeral {
  height: var(--header-height, 68px); // Slightly taller for more presence
  padding: 0 var.$spacing-sm;      // Adjusted padding
  display: flex;
  align-items: center;
  justify-content: center;
  position: sticky;
  top: 0;
  z-index: var.$z-index-sticky;

  // Base glassmorphic style
  @include mixins.glassmorphic-pane(
    '--color-bg-primary', '--color-border-glass', '--blur-glass', '--shadow-depth-md',
    var.$default-color-bg-primary-h, var.$default-color-bg-primary-s, calc(var.$default-color-bg-primary-l + 2%), 0.55, // Slightly less transparent base
    var.$default-color-border-glass-h, var.$default-color-border-glass-s, var.$default-color-border-glass-l, 0.2,
    var.$default-blur-glass, var.$scss-box-shadow-sm
  );
  border-bottom: 1px solid hsla(var(--color-border-glass-h), var(--color-border-glass-s), var(--color-border-glass-l), 0.25);
  transition: all var.$duration-smooth var.$ease-out-quad, border-bottom-color var.$duration-quick, box-shadow var.$duration-quick;
  
  // Background animated subtle glow/pattern (very subtle)
  &::after {
    content: '';
    position: absolute;
    inset: 0;
    border-radius: inherit; // Match potential header rounding if any
    background: linear-gradient(45deg, 
      hsla(var(--color-accent-primary-h), var(--color-accent-primary-s), var(--color-accent-primary-l), 0.02), 
      hsla(var(--color-accent-secondary-h), var(--color-accent-secondary-s), var(--color-accent-secondary-l), 0.03),
      hsla(var(--color-accent-primary-h), var(--color-accent-primary-s), var(--color-accent-primary-l), 0.02)
    );
    background-size: 300% 300%;
    animation: holoShimmer 30s ease infinite; // Slow shimmer
    opacity: 0; // Hidden by default, activated by states
    transition: opacity var.$duration-smooth;
    z-index: -1; // Behind content
    pointer-events: none;
  }


  &.ai-speaking-active {
    border-bottom-color: hsla(var(--color-voice-ai-speaking-h), var(--color-voice-ai-speaking-s), var(--color-voice-ai-speaking-l), 0.8);
    box-shadow: var(--shadow-depth-md), // Keep base shadow
      0 0 30px 6px hsla(var(--color-voice-ai-speaking-h), var(--color-voice-ai-speaking-s), var(--color-voice-ai-speaking-l), 0.4),
      inset 0 -3px 8px hsla(var(--color-voice-ai-speaking-h), var(--color-voice-ai-speaking-s), var(--color-voice-ai-speaking-l), 0.15);
    
    &::after { opacity: 0.7; animation-duration: 15s; } // More visible shimmer when AI speaks
  }
  &.user-listening-active {
    border-bottom-color: hsla(var(--color-voice-user-h), var(--color-voice-user-s), var(--color-voice-user-l), 0.8);
    box-shadow: var(--shadow-depth-md),
      0 0 30px 6px hsla(var(--color-voice-user-h), var(--color-voice-user-s), var(--color-voice-user-l), 0.35),
      inset 0 -3px 8px hsla(var(--color-voice-user-h), var(--color-voice-user-s), var(--color-voice-user-l), 0.12);
    
     &::after { opacity: 0.6; animation-duration: 20s; }
  }
}

.header-content-wrapper-ephemeral {
  width: 100%;
  max-width: var.$site-max-width;
  margin: 0 auto;
  padding: 0 var.$spacing-sm; // Consistent inner padding
  display: grid;
  grid-template-columns: minmax(auto, 1fr) auto minmax(auto, 1fr); // Left (Logo+Title) | Center (Hearing+Agent) | Right (Controls)
  align-items: center;
  height: 100%;
  gap: var.$spacing-md;

  @media (max-width: var.$breakpoint-lg) { // Adjust breakpoint for agent title visibility
    grid-template-columns: auto 1fr auto; // Logo | Center (Hearing only or smaller agent title) | Controls
    .active-agent-title-ephemeral { display: none; } // Hide full agent title, maybe show an icon or shorter version if space
  }
   @media (max-width: var.$breakpoint-md) {
    grid-template-columns: auto 1fr; // Logo | Controls
    .header-center-section { justify-self: end; } // Move hearing icon to right for more space for logo on mobile
    .active-agent-title-ephemeral { display: none; }
  }
}

.header-left-section {
  display: flex;
  align-items: center;
  justify-self: start;
  min-width: 0; // Allow shrinking
}

.logo-title-link-ephemeral {
  // Styles remain largely the same, ensure responsiveness of app-title-ephemeral
}

.app-logo-ephemeral { /* ... */ }
.app-title-ephemeral { /* ... */ }

.header-center-section {
  display: flex;
  align-items: center;
  justify-content: center; // Center its content (hearing icon, agent title)
  gap: var.$spacing-md;
  min-width: 0; // Allow shrinking
  overflow: hidden; // Prevent agent title from breaking layout
}

.hearing-icon-wrapper-ephemeral {
  width: 42px; // Slightly larger
  height: 42px;
  flex-shrink: 0; // Prevent shrinking
  // Existing styles for .idle, .listening, .speaking apply for pronounced visual feedback
  // Consider enhancing the ::before pseudo-element animation further or using multiple pseudo-elements for layered effects
  &.listening::before, &.speaking::before {
    animation-duration: 1.8s !important; // Faster pulse for active states
    animation-name: spin, subtlePulse !important;
    --opacity-pulse: 0.8 !important;
    --scale-pulse: 1.15 !important;
  }
  .hearing-icon-svg {
    // If SVG color needs to change based on state (listening/speaking),
    // this would ideally be done by making SVG paths use `currentColor`
    // and then setting the color on this .hearing-icon-svg element via CSS.
    // Or manipulate fill/stroke via JS if more complex changes are needed.
  }
}

.active-agent-title-ephemeral {
  font-size: calc(var.$font-size-base-default * 1.05); // Prominent but not overly large
  font-weight: 500;
  color: hsl(var(--color-text-primary-h), var(--color-text-primary-s), var(--color-text-primary-l));
  opacity: 0.9;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 250px; // Max width before ellipsis
  text-align: center;
  padding: var.$spacing-xs var.$spacing-sm;
  border-radius: var.$radius-md;
  background-color: hsla(var(--color-bg-secondary-h), var(--color-bg-secondary-s), var(--color-bg-secondary-l), 0.1);
  @include mixins.text-glow(
    '--color-accent-interactive', 3px,
    var.$default-color-accent-interactive-h, var.$default-color-accent-interactive-s, var.$default-color-accent-interactive-l, 0.25
  );
  transition: all var.$duration-quick;

  @media (max-width: 1100px) { // Example breakpoint for hiding/shortening
    display: none; // Or make it shorter, show icon only etc.
  }
}


.header-right-section {
  display: flex;
  align-items: center;
  gap: var.$spacing-xs; // Keep controls tighter
  justify-self: end;

  @media (min-width: var.$breakpoint-sm) {
    gap: calc(var.$spacing-xs + 2px); // Slightly more space on sm+
  }
}

.session-cost-display-ephemeral { /* ... styles remain similar, ensure good contrast ... */ }

// Ensure dropdown trigger buttons have a consistent, prominent style
// These styles will apply to the trigger buttons of UserSettingsDropdown, SiteMenuDropdown, VoiceControlsDropdown
.voice-controls-header-integration > button,
.user-settings-header-integration > button,
.site-menu-header-integration > button {
  @include buttonsFile.btn-ghost; // Base for ghost button behavior
  padding: var.$spacing-sm !important; // Ensure consistent padding for icon buttons
  border-radius: var.$radius-3xl !important; // Circular trigger
  
  &:hover, &:focus-visible, &[aria-expanded="true"] {
    background-color: hsla(var(--color-accent-interactive-h), var(--color-accent-interactive-s), var(--color-accent-interactive-l), 0.12) !important;
    color: hsl(var(--color-accent-interactive-h), var(--color-accent-interactive-s), var(--color-accent-interactive-l)) !important;
    .icon-base, .site-menu-trigger-icon { // Target icons within
        transform: scale(1.1);
    }
  }
  .icon-base, .site-menu-trigger-icon {
    transition: transform var.$duration-quick;
  }
}