// File: frontend/src/styles/layout/_chat-interface.scss
/**
 * @file _chat-interface.scss
 * @description Styles for the EphemeralChatLog component.
 * Refined for a highly subtle, transient feel with clear message distinction and graceful fading.
 * @version 3.1.0 - Improved fading, message accents, and overall subtlety.
 */

@use '../abstracts/variables' as var;
@use '../abstracts/mixins' as mixins;

.ephemeral-chat-log-container {
  position: fixed;
  top: calc(var(--header-height, #{var.$header-height-default}) + #{var.$spacing-xs});
  left: 50%;
  transform: translateX(-50%);
  width: clamp(280px, 40vw, 500px); // Even narrower for a more "glanceable" feel
  max-height: 220px; // Adjusted max-height
  z-index: var.$z-index-ephemeral-chat;
  pointer-events: none;
  opacity: 0;
  animation: fadeIn var.$duration-smooth var.$ease-out-quad 0.7s forwards;
  // --max-ephemeral-messages is set via :style in EphemeralChatLog.vue
}

.ephemeral-chat-log-scroller {
  width: 100%;
  height: 100%;
  overflow: hidden; // Visual only, content div scrolls
  position: relative;
  pointer-events: auto;

  @include mixins.glassmorphic-pane(
    '--color-bg-primary', // CSS Var prefix
    '--color-border-primary', // CSS Var prefix
    calc(var(--blur-glass) * 0.4), // Even more subtle blur
    'none', // No main shadow on scroller itself
    // Fallbacks
    var.$default-color-bg-primary-h, var.$default-color-bg-primary-s, var.$default-color-bg-primary-l, 0.15, // VERY low alpha for bg
    var.$default-color-border-primary-h, var.$default-color-border-primary-s, var.$default-color-border-primary-l, 0.05, // Almost invisible border
    calc(var.$default-blur-glass * 0.4),
    'none'
  );
  border-radius: var.$radius-md; // Slightly less pronounced radius
  box-shadow: inset 0 0 10px hsla(var(--shadow-color-h, var.$default-shadow-color-h), var(--shadow-color-s, var.$default-shadow-color-s), var(--shadow-color-l, var.$default-shadow-color-l), 0.02); // Faintest inset shadow
}

.ephemeral-chat-log-content {
  height: 100%;
  overflow-y: auto;
  display: flex;
  flex-direction: column-reverse;
  padding: var.$spacing-xs; // Reduced padding

  &::-webkit-scrollbar { width: 3px; } // Thinner scrollbar
  &::-webkit-scrollbar-track { background-color: transparent; }
  &::-webkit-scrollbar-thumb {
    background-color: hsla(var(--color-accent-primary-h), var(--color-accent-primary-s), var(--color-accent-primary-l), 0.1);
    border-radius: var.$radius-full;
    &:hover {
      background-color: hsla(var(--color-accent-primary-h), var(--color-accent-primary-s), var(--color-accent-primary-l), 0.25);
    }
  }
  scrollbar-width: thin;
  scrollbar-color: hsla(var(--color-accent-primary-h), var(--color-accent-primary-s), var(--color-accent-primary-l), 0.1) transparent;
}

.ephemeral-chat-log-fade-overlay--top,
.ephemeral-chat-log-fade-overlay--bottom {
  content: '';
  position: absolute;
  left: 0; right: 0;
  width: 100%;
  height: 2.5rem; // Height of the fade
  pointer-events: none;
  z-index: 2;
  border-radius: var.$radius-md; // Match parent scroller
}

.ephemeral-chat-log-fade-overlay--top {
  top: 0;
  background: linear-gradient(to bottom,
    hsla(var(--color-bg-primary-h), var(--color-bg-primary-s), var(--color-bg-primary-l), calc(var(--ephemeral-bg-alpha, 0.15) * 1)) 20%, // Match scroller bg alpha
    hsla(var(--color-bg-primary-h), var(--color-bg-primary-s), var(--color-bg-primary-l), 0) 100%
  );
  border-bottom-left-radius: 0;
  border-bottom-right-radius: 0;
}

.ephemeral-chat-log-fade-overlay--bottom {
  bottom: 0;
  background: linear-gradient(to top,
    hsla(var(--color-bg-primary-h), var(--color-bg-primary-s), var(--color-bg-primary-l), calc(var(--ephemeral-bg-alpha, 0.15) * 1)) 20%,
    hsla(var(--color-bg-primary-h), var(--color-bg-primary-s), var(--color-bg-primary-l), 0) 100%
  );
  border-top-left-radius: 0;
  border-top-right-radius: 0;
}

.ephemeral-message-item {
  padding: calc(var.$spacing-xs * 0.8) var.$spacing-sm; // Further compressed padding
  border-radius: var.$radius-sm; // Smaller radius for items
  margin-top: calc(var.$spacing-xs * 0.5); // Even tighter spacing
  max-width: 85%;
  font-size: calc(var.$font-size-xs * 0.95); // Slightly smaller than default xs
  line-height: 1.3;
  word-break: break-word;
  border: 1px solid transparent;
  transition: opacity 0.6s var.$ease-out-quad, transform 0.4s var.$ease-out-quad;
  position: relative; // For accent borders

  // Opacity ramp using nth-last-child, assuming MAX_EPHEMERAL_MESSAGES (from Vue component) is around 7
  // These selectors target from the "bottom" (newest message due to column-reverse)
  &:nth-last-child(1) { opacity: 0.85; } // Newest
  &:nth-last-child(2) { opacity: 0.8; }
  &:nth-last-child(3) { opacity: 0.7; }
  &:nth-last-child(4) { opacity: 0.55; }
  &:nth-last-child(5) { opacity: 0.4; }
  &:nth-last-child(6) { opacity: 0.25; }
  &:nth-last-child(7) { opacity: 0.1; } // Oldest visible of 7
  &:nth-last-child(n + 8) { // Any beyond 7 are practically invisible
    opacity: 0.05;
    pointer-events: none;
  }

  &.message-role-user {
    background-color: hsla(var(--color-voice-user-h), var(--color-voice-user-s), var(--color-voice-user-l), 0.05); // Very subtle
    color: hsl(var(--color-text-secondary-h), var(--color-text-secondary-s), calc(var(--color-text-secondary-l) + 15%));
    margin-left: auto;
    text-align: right;
    border-color: hsla(var(--color-voice-user-h), var(--color-voice-user-s), var(--color-voice-user-l), 0.08);
    // Subtle right accent
    &::after {
      content: ''; position: absolute; top: 2px; bottom: 2px; right: -1px; width: 2px;
      background-color: hsla(var(--color-voice-user-h), var(--color-voice-user-s), var(--color-voice-user-l), 0.2);
      border-radius: 0 var.$radius-sm var.$radius-sm 0;
      opacity: 0.7;
    }
  }

  &.message-role-assistant {
    background-color: hsla(var(--color-voice-ai-speaking-h), var(--color-voice-ai-speaking-s), var(--color-voice-ai-speaking-l), 0.04); // Very subtle
    color: hsl(var(--color-text-secondary-h), var(--color-text-secondary-s), var(--color-text-secondary-l));
    margin-right: auto;
    text-align: left;
    border-color: hsla(var(--color-voice-ai-speaking-h), var(--color-voice-ai-speaking-s), var(--color-voice-ai-speaking-l), 0.07);
    // Subtle left accent
    &::before {
      content: ''; position: absolute; top: 2px; bottom: 2px; left: -1px; width: 2px;
      background-color: hsla(var(--color-voice-ai-speaking-h), var(--color-voice-ai-speaking-s), var(--color-voice-ai-speaking-l), 0.25);
      border-radius: var.$radius-sm 0 0 var.$radius-sm;
      opacity: 0.7;
    }
  }
  
  &.message-role-system, &.message-role-error {
     background-color: hsla(var(--color-bg-tertiary-h), var(--color-bg-tertiary-s), var(--color-bg-tertiary-l), 0.05);
     color: hsl(var(--color-text-muted-h), var(--color-text-muted-s), var(--color-text-muted-l));
     font-style: italic;
     text-align: center;
     max-width: 100%;
     border-style: dotted; // Dotted for system/error in ephemeral
     border-width: 1px;
     border-color: hsla(var(--color-border-secondary-h), var(--color-border-secondary-s), var(--color-border-secondary-l), 0.15);
     padding: calc(var.$spacing-xs * 0.6) var.$spacing-sm;
  }
   &.message-role-error {
     color: hsl(var(--color-error-h), var(--color-error-s), var(--color-error-l), 0.8); // Slightly less intense error text
     background-color: hsla(var(--color-error-h), var(--color-error-s), var(--color-error-l), 0.03);
     border-color: hsla(var(--color-error-h), var(--color-error-s), var(--color-error-l), 0.15);
   }

  .message-content {
    :deep(p), :deep(ul), :deep(ol), :deep(li) {
      font-size: inherit !important;
      line-height: inherit !important;
      margin-bottom: calc(var.$spacing-xs / 3) !important; // Very tight
    }
    :deep(code:not(pre code)) {
      font-size: 0.9em !important;
      padding: 0.05em 0.2em !important; // Smaller inline code padding
      background-color: hsla(var(--color-text-muted-h), var(--color-text-muted-s), var(--color-text-muted-l), 0.05) !important;
      border-radius: var.$radius-xs;
    }
    :deep(pre) { display: none; }
  }
}