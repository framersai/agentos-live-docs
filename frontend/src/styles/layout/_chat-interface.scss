// File: frontend/src/styles/layout/_chat-interface.scss
/**
 * @file _chat-interface.scss
 * @description Styles for the EphemeralChatLog component.
 * Refined for extreme subtlety, improved message fading, and a more integrated "holographic ghost" feel.
 * @version 3.1.1 - Enhanced subtlety and fade effects.
 */

@use '../abstracts/variables' as var;
@use '../abstracts/mixins' as mixins;

.ephemeral-chat-log-container {
  position: fixed;
  top: calc(var(--header-height, #{var.$header-height-default}) + #{var.$spacing-xs / 2}); // Even closer to header
  left: 50%;
  transform: translateX(-50%);
  width: clamp(260px, 35vw, 480px); // Narrower
  max-height: 180px; // Reduced max-height for more transience
  z-index: var.$z-index-ephemeral-chat;
  pointer-events: none;
  opacity: 0;
  // Slower, more subtle fade-in for the container itself
  animation: fadeIn 0.8s var.$ease-out-quad 1s forwards; 
  transition: opacity 0.5s var.$ease-out-quad; // For dynamic show/hide if needed

  // This variable is set by the Vue component's :style binding
  // --max-ephemeral-messages: 5; // Example default, overridden by component
}

.ephemeral-chat-log-scroller {
  width: 100%;
  height: 100%;
  overflow: hidden; 
  position: relative;
  pointer-events: auto;

  // Extremely subtle glass effect, almost just a hint of a different layer
  background-color: hsla(var(--color-bg-primary-h), var(--color-bg-primary-s), var(--color-bg-primary-l), 0.05); // Very, very low alpha
  backdrop-filter: blur(2px); // Minimal blur
  border: 1px solid hsla(var(--color-border-primary-h), var(--color-border-primary-s), var(--color-border-primary-l), 0.03); // Almost invisible border
  border-radius: var.$radius-md; // Softer radius
  box-shadow: inset 0 0 8px hsla(var(--shadow-color-h), var(--shadow-color-s), var(--shadow-color-l), 0.02); // Barely there inset shadow
}

.ephemeral-chat-log-content {
  height: 100%;
  overflow-y: auto;
  display: flex;
  flex-direction: column-reverse;
  padding: calc(var.$spacing-xs / 2); // Minimal internal padding

  &::-webkit-scrollbar { width: 2px; } // Almost invisible scrollbar
  &::-webkit-scrollbar-track { background-color: transparent; }
  &::-webkit-scrollbar-thumb {
    background-color: hsla(var(--color-accent-primary-h), var(--color-accent-primary-s), var(--color-accent-primary-l), 0.08);
    border-radius: var.$radius-full;
    &:hover {
      background-color: hsla(var(--color-accent-primary-h), var(--color-accent-primary-s), var(--color-accent-primary-l), 0.2);
    }
  }
  scrollbar-width: thin;
  scrollbar-color: hsla(var(--color-accent-primary-h), var(--color-accent-primary-s), var(--color-accent-primary-l), 0.08) transparent;
}

// Top and Bottom fade overlays
.ephemeral-chat-log-fade-overlay--top,
.ephemeral-chat-log-fade-overlay--bottom {
  content: '';
  position: absolute;
  left: 0; right: 0;
  width: 100%;
  height: 2.8rem; // Fade height
  pointer-events: none;
  z-index: 2;
  border-radius: var.$radius-md; // Match parent scroller
}

.ephemeral-chat-log-fade-overlay--top {
  top: 0;
  background: linear-gradient(to bottom,
    hsla(var(--color-bg-primary-h), var(--color-bg-primary-s), var(--color-bg-primary-l), var(--ephemeral-overlay-alpha, 0.1)) 15%, // Match scroller bg alpha (use a CSS var)
    hsla(var(--color-bg-primary-h), var(--color-bg-primary-s), var(--color-bg-primary-l), 0) 90%
  );
  border-bottom-left-radius: 0;
  border-bottom-right-radius: 0;
}

.ephemeral-chat-log-fade-overlay--bottom {
  bottom: 0;
  background: linear-gradient(to top,
    hsla(var(--color-bg-primary-h), var(--color-bg-primary-s), var(--color-bg-primary-l), var(--ephemeral-overlay-alpha, 0.1)) 15%,
    hsla(var(--color-bg-primary-h), var(--color-bg-primary-s), var(--color-bg-primary-l), 0) 90%
  );
  border-top-left-radius: 0;
  border-top-right-radius: 0;
}

.ephemeral-message-item {
  padding: calc(var.$spacing-xs * 0.7) var.$spacing-sm; // Slightly more vertical padding
  border-radius: var.$radius-sm;
  margin-top: calc(var.$spacing-xs * 0.4);
  max-width: 90%;
  font-size: calc(var.$font-size-xs * 0.92); // Even smaller for ephemeral
  line-height: 1.3;
  word-break: break-word;
  border: 1px solid transparent; // Base for subtle borders
  transition: opacity 0.7s var.$ease-in-out-quad, transform 0.5s var.$ease-in-out-quad; // Slower, smoother fade
  
  // Fading logic using nth-last-child (MAX_EPHEMERAL_MESSAGES is 5 in component)
  // Opacity values are examples, adjust for desired fade profile.
  &:nth-last-child(1) { opacity: 0.75; transform: scale(1); }     // Newest
  &:nth-last-child(2) { opacity: 0.65; transform: scale(0.99); }
  &:nth-last-child(3) { opacity: 0.45; transform: scale(0.98); }
  &:nth-last-child(4) { opacity: 0.25; transform: scale(0.97); }
  &:nth-last-child(5) { opacity: 0.1;  transform: scale(0.96); }  // Oldest of 5
  &:nth-last-child(n + 6) { // Any beyond 5 are hidden quickly
    opacity: 0;
    transform: scale(0.95);
    pointer-events: none;
    height: 0; // Collapse if possible, though padding might prevent full collapse
    margin-top: 0;
    padding-top: 0;
    padding-bottom: 0;
    overflow: hidden;
  }

  &.message-role-user {
    background-color: hsla(var(--color-voice-user-h), var(--color-voice-user-s), var(--color-voice-user-l), 0.03); // Barely there
    color: hsl(var(--color-text-muted-h), var(--color-text-muted-s), var(--color-text-muted-l)); // Muted text
    margin-left: auto;
    text-align: right;
    border-right: 2px solid hsla(var(--color-voice-user-h), var(--color-voice-user-s), var(--color-voice-user-l), 0.15); // Subtle accent
    border-left: none;
  }

  &.message-role-assistant {
    background-color: hsla(var(--color-voice-ai-speaking-h), var(--color-voice-ai-speaking-s), var(--color-voice-ai-speaking-l), 0.025); // Barely there
    color: hsl(var(--color-text-muted-h), var(--color-text-muted-s), var(--color-text-muted-l));
    margin-right: auto;
    text-align: left;
    border-left: 2px solid hsla(var(--color-voice-ai-speaking-h), var(--color-voice-ai-speaking-s), var(--color-voice-ai-speaking-l), 0.2); // Subtle accent
    border-right: none;
  }
  
  &.message-role-system, &.message-role-error {
     background-color: hsla(var(--color-bg-tertiary-h), var(--color-bg-tertiary-s), var(--color-bg-tertiary-l), 0.03);
     color: hsl(var(--color-text-muted-h), var(--color-text-muted-s), var(--color-text-muted-l), 0.7); // Even more muted
     font-style: italic;
     text-align: center;
     max-width: 100%;
     border: 1px dotted hsla(var(--color-border-secondary-h), var(--color-border-secondary-s), var(--color-border-secondary-l), 0.1);
     padding: calc(var.$spacing-xs * 0.5) var.$spacing-sm;
  }
   &.message-role-error {
     color: hsl(var(--color-error-h), var(--color-error-s), var(--color-error-l), 0.6);
     background-color: hsla(var(--color-error-h), var(--color-error-s), var(--color-error-l), 0.02);
     border-color: hsla(var(--color-error-h), var(--color-error-s), var(--color-error-l), 0.1);
   }

  .message-content {
    :deep(p), :deep(ul), :deep(ol), :deep(li) {
      font-size: inherit !important;
      line-height: inherit !important;
      margin-bottom: calc(var.$spacing-xs / 4) !important; // Extremely tight
    }
    :deep(code) { display: inline; font-size: 0.95em !important; padding: 0.05em 0.2em !important; background-color: transparent !important; border: none !important;}
    :deep(pre) { display: none; }
  }
}