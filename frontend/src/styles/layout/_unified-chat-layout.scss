// File: frontend/src/styles/layout/_unified-chat-layout.scss
/**
 * @file _unified-chat-layout.scss
 * @description Styles for the UnifiedChatLayout.vue component. This layout is central
 * to chat-centric views, providing a consistent structure for main agent content,
 * the EphemeralChatLog, and VoiceInput. It incorporates "Ephemeral Harmony"
 * background effects and ensures a full-height, responsive experience.
 *
 * @role Defines the primary layout structure for chat interactions.
 * @dependencies `../abstracts/variables`, `../abstracts/mixins`, `../animations/keyframes`.
 * @version 2.0.0 - Enhanced for full-height layout, responsive padding, and theme-aware background effects.
 */

@use '../abstracts/variables' as var;
@use '../abstracts/mixins' as mixins;
// Keyframes for background effects should be in _keyframes.scss

.unified-chat-layout-wrapper {
  display: flex;
  flex-direction: column;
  height: 100%; // This layout attempts to fill its parent (e.g., .app-layout-main-content-ephemeral)
  width: 100%;
  overflow: hidden;
  position: relative;
  // Background is typically inherited or set by App.vue's shell
}

.unified-chat-background-effects {
  position: absolute; inset: 0; overflow: hidden; z-index: 0; pointer-events: none;
  inset: 0;
  overflow: hidden;
  z-index: 0; // Behind all actual UI content
  pointer-events: none; // Background should not be interactive

  .fixed-holo-grid {
    position: absolute;
    inset: 0;
    background-image: var(--bg-holo-grid-pattern-chat-layout, var(--bg-holo-grid-pattern, none));
    background-size: var(--bg-holo-grid-size-chat-layout, 60px) var(--bg-holo-grid-size-chat-layout, 60px); // Slightly smaller grid for subtlety
    opacity: var(--bg-holo-grid-opacity-chat-layout, 0.02); // Very subtle
    animation: holoGridScroll calc(var.$duration-pulse-long * 25) linear infinite alternate; // Slower scroll
  }

  .orbit-container { // From design document; ensure keyframes `orbitEffect` and `shapeTransformEffect` are defined
    position: absolute;
    top: 50%; left: 50%;
    width: 1px; height: 1px; // Animation origin
    animation-name: orbitEffect; // Keyframe defines rotation
    animation-timing-function: linear;
    animation-iteration-count: infinite;
    will-change: transform;

    .orbiting-shape {
      position: absolute;
      left: 0; top: 0; // Positioned relative to the animated orbit-container
      transform-origin: center;
      animation-name: shapeTransformEffect; // Keyframe defines scale/opacity changes
      animation-timing-function: var.$ease-in-out-sine;
      animation-iteration-count: infinite;
      animation-direction: alternate;
      will-change: transform, opacity;
      mix-blend-mode: overlay; // Or 'soft-light' depending on desired effect with theme colors
      opacity: 0; // Start transparent, animation brings it in
    }
  }
}

// EphemeralChatLog is absolutely positioned by its own styles, so it overlays this layout.

.unified-main-content-area {
  flex-grow: 1; // This area takes up the main vertical space between header/log and voice input
  display: flex; // Allows its child (slot) to also use flex properties if needed
  flex-direction: column; // Stacks content vertically
  position: relative; // For z-indexing if needed, above background effects
  z-index: 1;
  overflow: hidden; // IMPORTANT: The main content area itself should NOT scroll.
                     // The component slotted into #main-content (e.g., ChatWindow, CompactMessageRenderer)
                     // MUST manage its own internal scrolling.

  // Dynamic padding to account for fixed/sticky Header, EphemeralChatLog, and VoiceInput
  // These CSS variables should be updated by JavaScript if the heights of these elements change dynamically.
  // Fallbacks provide a reasonable default.
  // These paddings account for fixed/sticky Header, EphemeralChatLog, and VoiceInput
  // These paddings account for fixed/sticky Header, EphemeralChatLog, and VoiceInput
  --ephemeral-log-actual-height: var(--ephemeral-log-total-height, 0px);
  --voice-input-actual-height: var(--voice-input-panel-total-height, 90px); // Mobile default guess
  @media (min-width: var.$breakpoint-md) {
    --voice-input-actual-height: var(--voice-input-panel-total-height, 110px); // Desktop default guess
  }

  padding-top: calc(var(--header-actual-height, #{var.$header-height-default}) + var(--ephemeral-log-actual-height) + #{var.$spacing-xs} + env(safe-area-inset-top, 0px));
  padding-bottom: calc(var(--voice-input-actual-height) + #{var.$spacing-xs} + env(safe-area-inset-bottom, 0px));
  
  // Mobile: Minimal side padding, content within will be edge-to-edge.
  padding-left: calc(var.$spacing-xs + env(safe-area-inset-left, 0px));
  padding-right: calc(var.$spacing-xs + env(safe-area-inset-right, 0px));
  
  @media (min-width: var.$breakpoint-sm) {
    padding-left: calc(var.$spacing-sm + env(safe-area-inset-left, 0px));
    padding-right: calc(var.$spacing-sm + env(safe-area-inset-right, 0px));
    padding-top: calc(var(--header-actual-height, #{var.$header-height-default}) + var(--ephemeral-log-actual-height) + #{var.$spacing-sm} + env(safe-area-inset-top, 0px));
    padding-bottom: calc(var(--voice-input-actual-height) + #{var.$spacing-sm} + env(safe-area-inset-bottom, 0px));
  }


 
  // Desktop/Widescreen: Add horizontal margins to the content *inside* this area.
  // The direct child (slotted component like MainContentView) will have these margins applied.
  > * { // Targets the root of the slotted component (e.g., MainContentView)
    height: 100%;
    width: 100%;
    overflow-y: auto; // The slotted component handles its own scroll
    overflow-x: hidden;
    display: flex;
    flex-direction: column;
    margin-left: 0; // Default, overridden by media query
    margin-right: 0; // Default, overridden by media query
    max-width: 100%;   // Default, overridden by media query
    transition: margin 0.3s var.$ease-out-quad, max-width 0.3s var.$ease-out-quad;

    @include mixins.custom-scrollbar(
      '--color-accent-secondary', 0.35, 0.6, '--color-bg-primary', 0.08, 7px
    );

    // Widescreen margins (e.g., for screens > 768px or your preferred breakpoint)
    // User mentioned >800px, md is 768px, lg is 1024px. Let's use md as the start for margins.
    @media (min-width: var.$breakpoint-md) {
      margin-left: auto;
      margin-right: auto;
      // Example: max-width of 1280px for the main chat content area on large screens
      // This creates the side margins. Adjust as needed.
      max-width: var(--chat-content-max-width, 1100px); 
      padding-left: var.$spacing-md; // Internal padding within the max-width container
      padding-right: var.$spacing-md;
    }
    @media (min-width: var.$breakpoint-xl) {
        max-width: var(--chat-content-max-width-xl, 1280px);
        padding-left: var.$spacing-lg;
        padding-right: var.$spacing-lg;
    }
  }
}

.unified-voice-input-section {
  flex-shrink: 0;
  position: sticky;
  bottom: 0; left: 0; right: 0;
  z-index: calc(var.$z-index-content-overlay + 10);
  padding: var.$spacing-xs var.$spacing-sm; // Base padding for mobile
  padding-bottom: calc(var.$spacing-xs + env(safe-area-inset-bottom, 0px)); // Account for notch on bottom
  padding-left: calc(var.$spacing-sm + env(safe-area-inset-left, 0px));
  padding-right: calc(var.$spacing-sm + env(safe-area-inset-right, 0px));

  @media (min-width: var.$breakpoint-sm) {
    padding: var.$spacing-sm var.$spacing-md;
    padding-bottom: calc(var.$spacing-sm + env(safe-area-inset-bottom, 0px));
    padding-left: calc(var.$spacing-md + env(safe-area-inset-left, 0px));
    padding-right: calc(var.$spacing-md + env(safe-area-inset-right, 0px));
  }
  // Subtle backdrop to distinguish from scrolling content if needed
  // background: linear-gradient(to top, hsla(var(--color-bg-primary-h), var(--color-bg-primary-s), var(--color-bg-primary-l), 0.9) 0%, hsla(var(--color-bg-primary-h), var(--color-bg-primary-s), var(--color-bg-primary-l), 0) 100%);
  // padding-top: var.$spacing-md; // Create space for the gradient if used
}

// Keyframes for background effects must be globally available (e.g., in _keyframes.scss)
// Example:
// @keyframes orbitEffect { /* ... */ }
// @keyframes shapeTransformEffect { /* ... */ }
// @keyframes holoGridScroll { /* ... */ }