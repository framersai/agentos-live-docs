// File: frontend/src/styles/abstracts/_theme-engine.scss
/**
 * @file _theme-engine.scss
 * @description Generates CSS custom variables for every theme palette.
 * Default theme updated to Magenta Mystic.
 * @version 2.1.1 - Added Tailwind CSS IntelliSense disable comments.
 */
@use 'sass:map';
@use './theme-definitions.scss' as themes;

$theme-registry: (
  'magenta-mystic': ('is-dark': true,  'map': themes.$theme-magenta-mystic), // New default dark
  'twilight-neo':   ('is-dark': true,  'map': themes.$theme-twilight-neo),
  'aurora-daybreak':('is-dark': false, 'map': themes.$theme-aurora-daybreak),
  'warm-embrace':   ('is-dark': false, 'map': themes.$theme-warm-embrace)
);

// Aliases to map legacy theme names or provide simpler alternatives
$theme-aliases: (
  'ephemeral-holo-dark': 'twilight-neo',
  'aurora-light':        'aurora-daybreak',
  'legacy-warm-embrace': 'warm-embrace',
  'legacy-twilight-neo': 'twilight-neo',
  'default-dark':        'magenta-mystic', // Alias for default dark theme
  'default-light':       'aurora-daybreak' // Alias for default light theme
);

// Mixin to apply a theme map to a selector
@mixin apply-theme($theme-map-arg) {
  @each $prop, $val in $theme-map-arg {
    /* tailwindcss-intellisense-disable */
    #{$prop}: #{$val};
    /* tailwindcss-intellisense-enable */
  }
}

// Default theme (can be overridden by user preference via data-theme on <html>)
$default-theme-name: 'magenta-mystic'; // Updated default theme

:root {
  /* tailwindcss-intellisense-disable */
  @include apply-theme(map.get(map.get($theme-registry, $default-theme-name), 'map'));
  color-scheme: if(
    map.get(map.get($theme-registry, $default-theme-name), 'is-dark'),
    dark,
    light
  );
  /* tailwindcss-intellisense-enable */
}

// Generate theme overrides for specific data-theme attributes
@each $theme-id, $theme-meta in $theme-registry {
  html[data-theme='#{$theme-id}'] {
    /* tailwindcss-intellisense-disable */
    @include apply-theme(map.get($theme-meta, 'map'));
    color-scheme: if(map.get($theme-meta, 'is-dark'), dark, light);
    /* tailwindcss-intellisense-enable */
  }
}

// Generate styles for aliased themes
@each $alias-name, $target-theme-name in $theme-aliases {
  $target-meta-data: map.get($theme-registry, $target-theme-name);
  @if $target-meta-data {
    $target-theme-map: map.get($target-meta-data, 'map');
    $is-target-dark: map.get($target-meta-data, 'is-dark');

    html[data-theme='#{$alias-name}'] {
      /* tailwindcss-intellisense-disable */
      @include apply-theme($target-theme-map);
      color-scheme: if($is-target-dark, dark, light);
      /* tailwindcss-intellisense-enable */
    }
  } @else {
    @warn "Theme alias target '#{$target-theme-name}' not found in registry for alias '#{$alias-name}'.";
  }
}