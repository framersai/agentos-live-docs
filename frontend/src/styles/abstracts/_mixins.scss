/**
 * @file _mixins.scss
 * @description SCSS mixins for creating reusable style patterns like neomorphism,
 * glassmorphism, holographic effects, text effects, custom scrollbars,
 * and focus states. These mixins leverage CSS Custom Properties for theming
 * and SCSS variables for configuration and fallbacks.
 * @version 3.0.4 - Added alpha support for fill/background in neomorphic mixins.
 */

@use 'sass:math';
@use 'sass:color';
@use './variables' as var; // Ensure this path is correct relative to where this file is used or compiled from.

// --- Utility Function for HSL(A) CSS Variable Consumption ---
// Helper to construct hsla string from CSS variable prefixes.
// $default-h, $default-s, $default-l, $default-a are SCSS fallbacks if CSS vars are not defined.
@function get-themed-hsla($h-var-name, $s-var-name, $l-var-name, $a-var-name: null, $default-h: 0, $default-s: 0%, $default-l: 0%, $default-a: 1) {
  $resolved-h: var(#{$h-var-name}, $default-h);
  $resolved-s: var(#{$s-var-name}, $default-s);
  $resolved-l: var(#{$l-var-name}, $default-l);
  @if $a-var-name {
    $resolved-a: var(#{$a-var-name}, $default-a);
    @return hsla(#{$resolved-h}, #{$resolved-s}, #{$resolved-l}, #{$resolved-a});
  } @else {
    // If $a-var-name is not provided, but $default-a is not 1, it implies hsla is still desired.
    // However, to keep distinct hsl and hsla paths, we check if $default-a indicates transparency.
    // For robust explicit hsl vs hsla, the caller should be clear.
    // Given the function signature, if $a-var-name is null, we produce hsl.
    @return hsl(#{$resolved-h}, #{$resolved-s}, #{$resolved-l});
  }
}

// -----------------------------------------------------------------------------
// Glassmorphism
// -----------------------------------------------------------------------------
@mixin glassmorphic-pane(
  $bg-color-css-var-prefix: '--color-bg-glass',
  $border-color-css-var-prefix: '--color-border-glass',
  $blur-amount-css-var: '--blur-glass',
  $shadow-css-var: '--shadow-depth-md',
  // SCSS Fallbacks for CSS Variables:
  $default-bg-h: var.$default-color-bg-glass-h, $default-bg-s: var.$default-color-bg-glass-s, $default-bg-l: var.$default-color-bg-glass-l, $default-bg-a: var.$default-color-bg-glass-a,
  $default-border-h: var.$default-color-border-glass-h, $default-border-s: var.$default-color-border-glass-s, $default-border-l: var.$default-color-border-glass-l, $default-border-a: var.$default-color-border-glass-a,
  $default-blur: var.$default-blur-glass,
  $default-shadow: var.$scss-box-shadow-md
) {
  background-color: get-themed-hsla(
    #{$bg-color-css-var-prefix}-h, #{$bg-color-css-var-prefix}-s, #{$bg-color-css-var-prefix}-l, #{$bg-color-css-var-prefix}-a,
    $default-bg-h, $default-bg-s, $default-bg-l, $default-bg-a
  );
  backdrop-filter: blur(var(#{$blur-amount-css-var}, #{$default-blur}));
  -webkit-backdrop-filter: blur(var(#{$blur-amount-css-var}, #{$default-blur}));
  border: 1px solid get-themed-hsla(
    #{$border-color-css-var-prefix}-h, #{$border-color-css-var-prefix}-s, #{$border-color-css-var-prefix}-l, #{$border-color-css-var-prefix}-a,
    $default-border-h, $default-border-s, $default-border-l, $default-border-a
  );
  box-shadow: var(#{$shadow-css-var}, #{$default-shadow});
}

// -----------------------------------------------------------------------------
// Neomorphism
// -----------------------------------------------------------------------------
@mixin neomorphic-inset(
  $fill-color-var-prefix: '--color-bg-secondary',
  $blur: 8px,
  $distance: 4px,
  $shadow-opacity-var: '--shadow-opacity-soft',
  $radius: var.$radius-md,
  $shadow-h-var: '--shadow-color-h',
  $shadow-s-var: '--shadow-color-s',
  $shadow-l-var: '--shadow-color-l',
  $highlight-l-modifier-css-var: '--shadow-highlight-modifier',
  // SCSS Fallbacks
  $fb-fill-h: var.$default-color-bg-secondary-h,
  $fb-fill-s: var.$default-color-bg-secondary-s,
  $fb-fill-l: var.$default-color-bg-secondary-l,
  $fb-fill-a: 1, // <<< ADDED new parameter with default (1 for opaque)
  $fb-shadow-op: var.$default-shadow-opacity-soft,
  $fb-shadow-h: var.$default-shadow-color-h,
  $fb-shadow-s: var.$default-shadow-color-s,
  $fb-shadow-l: var.$default-shadow-color-l,
  $fb-highlight-l-factor: var.$default-shadow-highlight-l-factor
) {
  border-radius: $radius;
  // MODIFIED to use get-themed-hsla for background color, supporting alpha
  background-color: get-themed-hsla(
    #{$fill-color-var-prefix}-h, // CSS Var name for Hue
    #{$fill-color-var-prefix}-s, // CSS Var name for Saturation
    #{$fill-color-var-prefix}-l, // CSS Var name for Lightness
    #{$fill-color-var-prefix}-a, // CSS Var name for Alpha (e.g., --color-bg-secondary-a)
    $fb-fill-h,                  // SCSS Fallback for Hue
    $fb-fill-s,                  // SCSS Fallback for Saturation
    $fb-fill-l,                  // SCSS Fallback for Lightness
    $fb-fill-a                   // SCSS Fallback for Alpha (from new parameter)
  );

  $scss-shadow-base-l: $fb-shadow-l;
  $scss-highlight-l: min(100%, $scss-shadow-base-l + ($scss-shadow-base-l * $fb-highlight-l-factor));

  $dark-shadow-color-val: hsla(
    var(#{$shadow-h-var}, $fb-shadow-h),
    var(#{$shadow-s-var}, $fb-shadow-s),
    var(#{$shadow-l-var}, $scss-shadow-base-l),
    var(#{$shadow-opacity-var}, $fb-shadow-op)
  );

  $light-shadow-color-val: hsla(
    var(#{$shadow-h-var}, $fb-shadow-h),
    var(#{$shadow-s-var}, $fb-shadow-s),
    var(--shadow-color-highlight-l, calc(var(#{$shadow-l-var}, #{$scss-shadow-base-l}) + var(#{$highlight-l-modifier-css-var}, #{($scss-highlight-l - $scss-shadow-base-l)}))),
    var(#{$shadow-opacity-var}, $fb-shadow-op)
  );

  box-shadow: inset #{$distance} #{$distance} #{$blur} #{$dark-shadow-color-val},
              inset #{-$distance} #{-$distance} #{$blur} #{$light-shadow-color-val};
}

@mixin neomorphic-extrude(
  $bg-color-var-prefix: '--color-bg-primary', // Changed from $fill-color-var-prefix for consistency
  $distance: 6px,
  $blur: 12px,
  $shadow-opacity-var: '--shadow-opacity-soft',
  $radius: var.$radius-lg,
  $shadow-h-var: '--shadow-color-h',
  $shadow-s-var: '--shadow-color-s', // Corrected from '--color-shadow-s'
  $shadow-l-var: '--shadow-color-l',
  $highlight-l-modifier-css-var: '--shadow-highlight-modifier',
  // SCSS Fallbacks
  $fb-bg-h: var.$default-color-bg-primary-h, // fb-bg-* for background
  $fb-bg-s: var.$default-color-bg-primary-s,
  $fb-bg-l: var.$default-color-bg-primary-l,
  $fb-bg-a: 1, // <<< ADDED new parameter with default (1 for opaque)
  $fb-shadow-op: var.$default-shadow-opacity-soft,
  $fb-shadow-h: var.$default-shadow-color-h,
  $fb-shadow-s: var.$default-shadow-color-s,
  $fb-shadow-l: var.$default-shadow-color-l,
  $fb-highlight-l-factor: var.$default-shadow-highlight-l-factor
) {
  border-radius: $radius;
  // MODIFIED to use get-themed-hsla for background color, supporting alpha
  background-color: get-themed-hsla(
    #{$bg-color-var-prefix}-h,   // CSS Var name for Hue
    #{$bg-color-var-prefix}-s,   // CSS Var name for Saturation
    #{$bg-color-var-prefix}-l,   // CSS Var name for Lightness
    #{$bg-color-var-prefix}-a,   // CSS Var name for Alpha (e.g., --color-bg-primary-a)
    $fb-bg-h,                    // SCSS Fallback for Hue
    $fb-bg-s,                    // SCSS Fallback for Saturation
    $fb-bg-l,                    // SCSS Fallback for Lightness
    $fb-bg-a                     // SCSS Fallback for Alpha (from new parameter)
  );

  $scss-shadow-base-l: $fb-shadow-l;
  $scss-highlight-l: min(100%, $scss-shadow-base-l + ($scss-shadow-base-l * $fb-highlight-l-factor));

  $dark-shadow-color-val: hsla(
    var(#{$shadow-h-var}, $fb-shadow-h),
    var(#{$shadow-s-var}, $fb-shadow-s),
    var(#{$shadow-l-var}, $scss-shadow-base-l),
    var(#{$shadow-opacity-var}, $fb-shadow-op)
  );

  $light-shadow-color-val: hsla(
    var(#{$shadow-h-var}, $fb-shadow-h),
    var(#{$shadow-s-var}, $fb-shadow-s),
    var(--shadow-color-highlight-l, calc(var(#{$shadow-l-var}, #{$scss-shadow-base-l}) + var(#{$highlight-l-modifier-css-var}, #{($scss-highlight-l - $scss-shadow-base-l)}))),
    var(#{$shadow-opacity-var}, $fb-shadow-op)
  );

  box-shadow: #{$distance} #{$distance} #{$blur} #{$dark-shadow-color-val},
              #{-$distance} #{-$distance} #{$blur} #{$light-shadow-color-val};
}

// ... (rest of the _mixins.scss file: Holographic, Text Effects, Focus, Scrollbar)
// -----------------------------------------------------------------------------
// Holographic Effects
// -----------------------------------------------------------------------------
@mixin holographic-border-glow(
  $accent-color-var-prefix: '--color-holographic-glow-1',
  $secondary-accent-var-prefix: '--color-holographic-glow-2',
  $border-width: 2px,
  $animation-duration: 3s,
  $radius: var.$radius-holographic-default,
  // SCSS Fallbacks for glow colors
  $fb-glow1-h: var.$default-color-holographic-glow-1-h, $fb-glow1-s: var.$default-color-holographic-glow-1-s, $fb-glow1-l: var.$default-color-holographic-glow-1-l, $fb-glow1-a: var.$default-color-holographic-glow-1-a,
  $fb-glow2-h: var.$default-color-holographic-glow-2-h, $fb-glow2-s: var.$default-color-holographic-glow-2-s, $fb-glow2-l: var.$default-color-holographic-glow-2-l, $fb-glow2-a: var.$default-color-holographic-glow-2-a
) {
  position: relative;
  border-radius: $radius;
  z-index: 0;

  &::before {
    content: '';
    position: absolute;
    top: -$border-width; left: -$border-width; right: -$border-width; bottom: -$border-width;
    border-radius: inherit;
    padding: $border-width;
    background: conic-gradient(
      from 0deg,
      get-themed-hsla(#{$accent-color-var-prefix}-h, #{$accent-color-var-prefix}-s, #{$accent-color-var-prefix}-l, #{$accent-color-var-prefix}-a, $fb-glow1-h, $fb-glow1-s, $fb-glow1-l, $fb-glow1-a),
      get-themed-hsla(#{$secondary-accent-var-prefix}-h, #{$secondary-accent-var-prefix}-s, #{$secondary-accent-var-prefix}-l, #{$secondary-accent-var-prefix}-a, $fb-glow2-h, $fb-glow2-s, $fb-glow2-l, $fb-glow2-a),
      get-themed-hsla(#{$accent-color-var-prefix}-h, #{$accent-color-var-prefix}-s, #{$accent-color-var-prefix}-l, #{$accent-color-var-prefix}-a, $fb-glow1-h, $fb-glow1-s, $fb-glow1-l, $fb-glow1-a)
    );
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    animation: spin #{$animation-duration} linear infinite;
    z-index: -1;
  }
}

// -----------------------------------------------------------------------------
// Text Effects
// -----------------------------------------------------------------------------
@mixin text-glow(
  $glow-color-var-prefix: '--color-accent-glow',
  $glow-radius: 6px,
  // SCSS Fallbacks for glow color HSL(A)
  $fb-glow-h: var.$default-color-accent-glow-h, $fb-glow-s: var.$default-color-accent-glow-s, $fb-glow-l: var.$default-color-accent-glow-l, $fb-glow-a: var.$default-color-accent-glow-a
) {
  text-shadow: 0 0 $glow-radius get-themed-hsla(#{$glow-color-var-prefix}-h, #{$glow-color-var-prefix}-s, #{$glow-color-var-prefix}-l, #{$glow-color-var-prefix}-a, $fb-glow-h, $fb-glow-s, $fb-glow-l, $fb-glow-a);
}

@mixin gradient-text($direction, $color-stops...) {
  background: linear-gradient($direction, $color-stops);
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;
  color: transparent;
}

// -----------------------------------------------------------------------------
// Focus States
// -----------------------------------------------------------------------------
@mixin focus-ring(
  $base-bg-color-var-prefix: '--color-bg-primary',
  $ring-accent-color-var-prefix: '--color-accent-interactive',
  $offset-width: 2px,
  $ring-thickness: 2px,
  $ring-opacity: 0.7,
  // SCSS Fallbacks for HSL components
  $fb-base-bg-h: var.$default-color-bg-primary-h, $fb-base-bg-s: var.$default-color-bg-primary-s, $fb-base-bg-l: var.$default-color-bg-primary-l,
  $fb-ring-h: var.$default-color-accent-interactive-h, $fb-ring-s: var.$default-color-accent-interactive-s, $fb-ring-l: var.$default-color-accent-interactive-l
) {
  outline: none;
  box-shadow: 0 0 0 #{$offset-width} hsl(var(#{$base-bg-color-var-prefix}-h, $fb-base-bg-h), var(#{$base-bg-color-var-prefix}-s, $fb-base-bg-s), var(#{$base-bg-color-var-prefix}-l, $fb-base-bg-l)),
              0 0 0 ($offset-width + $ring-thickness) hsla(var(#{$ring-accent-color-var-prefix}-h, $fb-ring-h), var(#{$ring-accent-color-var-prefix}-s, $fb-ring-s), var(#{$ring-accent-color-var-prefix}-l, $fb-ring-l), $ring-opacity);
}

// -----------------------------------------------------------------------------
// Custom Scrollbar
// -----------------------------------------------------------------------------
@mixin custom-scrollbar(
  $thumb-color-var-prefix: '--color-accent-primary',
  $thumb-base-alpha: 0.4,
  $thumb-hover-alpha: 0.65,
  $track-color-var-prefix: '--color-bg-secondary',
  $track-alpha: 0.3,
  $width: 8px,
  $border-radius: var.$radius-full,
  // SCSS Fallbacks for HSL components
  $fb-thumb-h: var.$default-color-accent-primary-h, $fb-thumb-s: var.$default-color-accent-primary-s, $fb-thumb-l: var.$default-color-accent-primary-l,
  $fb-track-h: var.$default-color-bg-secondary-h, $fb-track-s: var.$default-color-bg-secondary-s, $fb-track-l: var.$default-color-bg-secondary-l
) {
  $thumb-base-color-val: hsla(var(#{$thumb-color-var-prefix}-h, $fb-thumb-h), var(#{$thumb-color-var-prefix}-s, $fb-thumb-s), var(#{$thumb-color-var-prefix}-l, $fb-thumb-l), $thumb-base-alpha);
  $thumb-hover-color-val: hsla(var(#{$thumb-color-var-prefix}-h, $fb-thumb-h), var(#{$thumb-color-var-prefix}-s, $fb-thumb-s), var(#{$thumb-color-var-prefix}-l, $fb-thumb-l), $thumb-hover-alpha);
  $track-color-val: hsla(var(#{$track-color-var-prefix}-h, $fb-track-h), var(#{$track-color-var-prefix}-s, $fb-track-s), var(#{$track-color-var-prefix}-l, $fb-track-l), $track-alpha);

  &::-webkit-scrollbar {
    width: $width;
    height: $width;
  }
  &::-webkit-scrollbar-track {
    background-color: $track-color-val;
    border-radius: $border-radius;
  }
  &::-webkit-scrollbar-thumb {
    background-color: $thumb-base-color-val;
    border-radius: $border-radius;
    border: if($width > 4px, 2px solid transparent, 1px solid transparent);
    background-clip: content-box;
    transition: background-color var.$duration-quick var.$ease-out-quad;
    &:hover {
      background-color: $thumb-hover-color-val;
    }
  }
  scrollbar-width: thin;
  scrollbar-color: $thumb-base-color-val $track-color-val;
}