// File: frontend/src/styles/components/_ephemeral-chat-log.scss
/**
 * @file _ephemeral-chat-log.scss
 * @description Styles for the EphemeralChatLog component.
 * Creates a top-mounted, semi-transparent, auto-scrolling display for recent messages.
 * @version 2.0.0
 */

@use '../abstracts/variables' as var;
@use '../abstracts/mixins' as mixins;

.ephemeral-chat-log-container {
  position: fixed; // Positioned relative to the viewport
  top: calc(var(--header-height) + var.$spacing-sm); // Below the main app header
  left: 50%;
  transform: translateX(-50%);
  width: clamp(300px, 50vw, 600px); // Responsive width
  max-height: var(--chat-log-height, 200px); // Max height before scrolling
  z-index: var.$z-index-ephemeral-chat;
  pointer-events: none; // The container itself doesn't intercept mouse events
  opacity: 0; // Initially hidden, fade in
  animation: fadeIn var.$duration-smooth var.$ease-out-quad forwards;
  animation-delay: 0.5s; // Slight delay to appear after main UI
}

.ephemeral-chat-log {
  width: 100%;
  height: 100%;
  padding: var.$spacing-sm;
  border-radius: var.$radius-lg;
  overflow: hidden; // Clip children, internal div will scroll
  pointer-events: auto; // The log itself can be interacted with (e.g. scroll if enabled)

  @include mixins.glassmorphic-pane(
    hsla(var(--color-bg-glass-h), var(--color-bg-glass-s), var(--color-bg-glass-l), 0.75), // Slightly more opaque glass
    hsla(var(--color-border-glass-h), var(--color-border-glass-s), var(--color-border-glass-l), 0.4),
    var(--blur-glass),
    var(--shadow-depth-md) // Softer shadow than main panels
  );
  box-shadow: 0 5px 25px hsla(var(--shadow-color-h), var(--shadow-color-s), var(--shadow-color-l), calc(var(--shadow-opacity-deep) * 0.8));

  .messages-scroll-area {
    height: 100%;
    overflow-y: auto;
    display: flex;
    flex-direction: column-reverse; // New messages at bottom, scroll pushes old up
    padding-right: var.$spacing-xs; // Space for scrollbar if it appears

    @include mixins.custom-scrollbar(
      hsla(var(--color-accent-primary-h), var(--color-accent-primary-s), var(--color-accent-primary-l), 0.3), // Thumb
      transparent // Track, to maintain glass effect
    );
  }

  // Fade-out effect at the top of the scroll area
  &::before {
    content: '';
    position: absolute;
    top: 0; // Use padding of .ephemeral-chat-log to position
    left: 0; // Use padding
    right: 0; // Use padding
    height: calc(var.$spacing-sm * 2); // Height of the fade gradient
    background: linear-gradient(to bottom,
      hsla(var(--color-bg-glass-h), var(--color-bg-glass-s), var(--color-bg-glass-l), var(--color-bg-glass-a)) 60%, // Match glass bg
      transparent
    );
    z-index: 1; // Above messages
    pointer-events: none;
    border-radius: var.$radius-lg var.$radius-lg 0 0; // Match parent's top radius
  }
}

.ephemeral-message-item {
  padding: calc(var.$spacing-xs * 1.25) var.$spacing-sm;
  border-radius: var.$radius-md;
  margin-top: var.$spacing-xs; // Appears as margin-bottom due to flex-direction: column-reverse
  max-width: 95%; // Messages don't take full width
  font-size: var.$font-size-sm;
  line-height: 1.45;
  word-break: break-word;
  animation: ephemeralMessageIn var.$duration-movement var.$ease-out-quint forwards;
  border: 1px solid transparent; // Base for transition
  transition: background-color var.$duration-quick, border-color var.$duration-quick, opacity var.$duration-smooth;

  // Opacity ramp for older messages (conceptual, JS might be needed for precise control)
  // For example, if JS adds classes like .ephemeral-message-item--fade-1, .ephemeral-message-item--fade-2
  &:nth-last-child(n + 4) { // Style messages beyond the 3rd from the "bottom" (newest)
    opacity: 0.6;
  }
  &:nth-last-child(n + 6) {
    opacity: 0.3;
  }
   &:nth-last-child(n + 8) { // Messages older than the 7th will be nearly invisible
    opacity: 0.1;
    pointer-events: none; // And non-interactive
  }


  &.user {
    background-color: hsla(var(--color-voice-user-h), var(--color-voice-user-s), var(--color-voice-user-l), 0.1);
    color: hsl(var(--color-text-primary-h), var(--color-text-primary-s), var(--color-text-primary-l));
    margin-left: auto;
    border-color: hsla(var(--color-voice-user-h), var(--color-voice-user-s), var(--color-voice-user-l), 0.15);
  }

  &.assistant {
    background-color: hsla(var(--color-voice-ai-h), var(--color-voice-ai-s), var(--color-voice-ai-l), 0.1);
    color: hsl(var(--color-text-primary-h), var(--color-text-primary-s), var(--color-text-primary-l));
    margin-right: auto;
    border-color: hsla(var(--color-voice-ai-h), var(--color-voice-ai-s), var(--color-voice-ai-l), 0.15);
    position: relative; // For potential pseudo-element accents

    // Optional: subtle holographic accent for AI messages
    // &::before {
    //   content: '';
    //   position: absolute;
    //   left: -1px; top: 0; bottom: 0; width: 2px;
    //   background: hsl(var(--color-voice-ai-h), var(--color-voice-ai-s), var(--color-voice-ai-l));
    //   border-radius: 2px 0 0 2px;
    //   opacity: 0.5;
    //   filter: blur(1px);
    // }
  }

  &.system, &.error {
    background-color: hsla(var(--color-bg-tertiary-h), var(--color-bg-tertiary-s), var(--color-bg-tertiary-l), 0.2);
    color: hsl(var(--color-text-muted-h), var(--color-text-muted-s), var(--color-text-muted-l));
    font-style: italic;
    font-size: var.$font-size-xs;
    text-align: center;
    margin-left: auto;
    margin-right: auto;
    max-width: 100%;
  }
  &.error {
    color: hsl(var(--color-error-h), var(--color-error-s), var(--color-error-l));
    background-color: hsla(var(--color-error-h), var(--color-error-s), var(--color-error-l), 0.1);
    border-color: hsla(var(--color-error-h), var(--color-error-s), var(--color-error-l), 0.2);
  }

  .message-role {
    font-weight: 600;
    font-size: 0.7rem;
    opacity: 0.7;
    margin-right: var.$spacing-xs;
    text-transform: uppercase;
  }
  .message-content {
    // Prose styles will be applied if content is markdown
  }
}

// Ensure this animation is defined in _keyframes.scss
// @keyframes ephemeralMessageIn {
//   from { opacity: 0; transform: translateY(10px) scale(0.98); }
//   to { opacity: 1; transform: translateY(0) scale(1); }
// }