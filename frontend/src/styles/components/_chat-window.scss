// File: frontend/src/styles/components/_chat-window.scss
/**
 * @file _chat-window.scss
 * @description Styles for the ChatWindow.vue component, the main interface for displaying
 * conversation history. Implements "Ephemeral Harmony" design principles with a focus on
 * readability, theme-aware message bubbles, loading states, and welcome messages.
 *
 * @role Defines the visual appearance and layout of the chat message display area.
 * @dependencies `../abstracts/variables`, `../abstracts/mixins`, `./message`.
 * @assumptions ChatWindow.vue component structure uses classes like `.chat-window-ephemeral`,
 * `.messages-list-ephemeral`, `.loading-indicator-ephemeral`, etc.
 * CSS custom properties for theming are available.
 * Keyframe animations are defined in `_keyframes.scss`.
 * Message bubble styling is primarily handled by `_message.scss`.
 * @version 2.1.2 - Corrected SASS calculation for blur amount in glassmorphic-pane mixin call.
 */

@use '../abstracts/variables' as var;
@use '../abstracts/mixins' as mixins;
// @use './message' as messageStyles; // Message styles are global

.chat-window-ephemeral {
  display: flex;
  flex-direction: column;
  height: 100%; 
  overflow: hidden; 
  position: relative;
}

.messages-list-ephemeral {
  flex-grow: 1; 
  overflow-y: auto; 
  overflow-x: hidden; 
  padding: var.$spacing-md var.$spacing-sm; 
  display: flex;
  flex-direction: column; 
  gap: var.$spacing-xs; 

  @media (min-width: var.$breakpoint-md) {
    padding: var.$spacing-lg var.$spacing-md; 
  }

  @include mixins.custom-scrollbar(
    $thumb-color-var-prefix: '--color-accent-interactive', 
    $thumb-base-alpha: 0.45,
    $thumb-hover-alpha: 0.65,
    $track-color-var-prefix: '--color-bg-secondary', 
    $track-alpha: 0.1, 
    $width: 7px, 
    $border-radius: var.$radius-sm
  );
  scroll-behavior: smooth;
}

// --- Welcome Message / Initial State ---
.chat-welcome-ephemeral {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  padding: var.$spacing-2xl var.$spacing-lg;
  margin: auto; 
  color: hsl(var(--color-text-muted-h, #{var.$default-color-text-muted-h}), var(--color-text-muted-s, #{var.$default-color-text-muted-s}), var(--color-text-muted-l, #{var.$default-color-text-muted-l}));
  opacity: 0; 
  animation: fadeIn 0.8s var.$ease-out-expo 0.3s forwards;

  .welcome-logo-ephemeral {
    width: clamp(60px, 15vw, 100px); 
    height: auto;
    margin-bottom: var.$spacing-lg;
    opacity: var(--opacity-idle, 0.7); 
    transform: scale(1); 
    animation: breathingEffect var.$duration-pulse-long var.$ease-in-out-sine infinite; 
    --opacity-idle: #{0.7}; 
    --scale-breath: #{1.03}; 
    --opacity-breath: #{0.9}; 
  }

  .welcome-title-ephemeral {
    font-family: var(--font-family-display, #{var.$font-family-display});
    font-size: clamp(#{var.$font-size-xl}, 4vw, calc(#{var.$font-size-display-default} * 0.85));
    font-weight: 600;
    color: hsl(var(--color-text-primary-h, #{var.$default-color-text-primary-h}), var(--color-text-primary-s, #{var.$default-color-text-primary-s}), var(--color-text-primary-l, #{var.$default-color-text-primary-l}));
    margin-bottom: var.$spacing-sm;
    @include mixins.text-glow(
        $glow-color-var-prefix: '--color-accent-primary', 
        $fb-glow-h: var.$default-color-accent-primary-h, // Added fallbacks
        $fb-glow-s: var.$default-color-accent-primary-s,
        $fb-glow-l: var.$default-color-accent-primary-l,
        $fb-glow-a: 0.2, 
        $glow-radius: 8px
    );
  }

  .welcome-subtitle-ephemeral {
    font-size: var.$font-size-lg;
    max-width: 45ch; 
    line-height: 1.6;
    margin-bottom: var.$spacing-xl;
    color: hsl(var(--color-text-secondary-h, #{var.$default-color-text-secondary-h}), var(--color-text-secondary-s, #{var.$default-color-text-secondary-s}), var(--color-text-secondary-l, #{var.$default-color-text-secondary-l}));
  }

  .welcome-actions-ephemeral { 
    display: flex;
    gap: var.$spacing-md;
  }
}

// --- Loading Indicator (for when AI is "typing" or processing) ---
.loading-indicator-ephemeral {
  display: flex;
  align-items: center;
  justify-content: center; 
  padding: var.$spacing-md var.$spacing-lg;
  margin: var.$spacing-sm auto; 
  max-width: 220px; 
  border-radius: var.$radius-xl;
  // Define a CSS variable for the calculated blur amount
  // Assuming var.$default-blur-glass is '10px'
  --loading-indicator-blur: #{10 * 0.5}px; // SASS calculates this to '5px'
  
  @include mixins.glassmorphic-pane(
    $bg-color-css-var-prefix: '--color-bg-secondary',
    $border-color-css-var-prefix: '--color-border-glass',
    $blur-amount-css-var: '--loading-indicator-blur', // Use the defined CSS variable
    $fb-blur: #{10 * 0.5}px, // SASS calculated fallback: 5px
    $shadow-css-var: '--shadow-depth-md',
    $fb-bg-a: 0.75, 
    $fb-border-a: 0.3
  );
  animation: subtleHoloGlowPulse 2.5s infinite alternate; 

  .loading-dot-ephemeral {
    width: 10px;
    height: 10px;
    margin: 0 calc(#{var.$spacing-xs} / 2); // SASS calc
    background-color: hsl(var(--color-accent-interactive-h, #{var.$default-color-accent-interactive-h}), var(--color-accent-interactive-s, #{var.$default-color-accent-interactive-s}), var(--color-accent-interactive-l, #{var.$default-color-accent-interactive-l}));
    border-radius: 100%;
    display: inline-block;
    animation: bounceDelay 1.4s infinite ease-in-out both; 

    &:nth-child(1) { animation-delay: -0.32s; }
    &:nth-child(2) { animation-delay: -0.16s; }
  }
}

// --- Scroll-to-Bottom Button ---
.scroll-to-bottom-button-ephemeral {
  position: absolute;
  bottom: var.$spacing-md;
  right: var.$spacing-md;
  z-index: calc(#{var.$z-index-content-overlay} + 5); // SASS calc
 
  @include mixins.neomorphic-extrude(
    $bg-color-var-prefix: '--color-accent-secondary',
    $fb-bg-a: 0.9, 
    $distance: 3px,
    $blur: 6px,
    $radius: var.$radius-full, 
    $shadow-opacity-var: '--shadow-opacity-medium'
  );
  padding: var.$spacing-sm !important; 
  width: 44px; height: 44px; 
  
  .icon-base { 
    width: 1.5rem; height: 1.5rem;
    color: hsl(var(--color-text-on-secondary-h, #{var.$default-color-text-on-secondary-h}), var(--color-text-on-secondary-s, #{var.$default-color-text-on-secondary-s}), var(--color-text-on-secondary-l, #{var.$default-color-text-on-secondary-l}));
  }

  &:hover {
    transform: scale(1.08);
    box-shadow: var(--shadow-depth-lg, #{var.$scss-box-shadow-lg}); 
  }
  &:active {
    transform: scale(0.95);
  }
}
