// File: frontend/src/styles/components/_buttons.scss
/**
 * @file _buttons.scss
 * @description Base styling & mixins for button components.
 * Declarations within mixins like `btn-ghost-look` are placed before nested rules
 * to align with SASS best practices and avoid `[mixed-decls]` warnings.
 * @version 3.0.2 - Confirmed structure for `btn-ghost-look`.
 */

@use '../abstracts/variables' as var;
@use '../abstracts/mixins' as commonMixins;

// ─────────────────────────────────────────────────────────────────────────────
// BASE BUTTON MIXIN
// ─────────────────────────────────────────────────────────────────────────────
@mixin base-button-styles {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var.$spacing-xs;
  padding: var.$spacing-sm var.$spacing-lg;

  border-radius: var.$radius-holographic-default; // Ensure this var is defined in _variables.scss

  font-family: var(--font-sans, #{var.$font-family-sans});
  font-size: var.$font-size-base-default; // Ensure this var is defined
  font-weight: 600;
  line-height: 1.2;
  text-align: center;
  text-decoration: none;
  white-space: nowrap;

  cursor: pointer;
  user-select: none;
  border: 1px solid transparent;

  transition: var.$duration-quick var.$ease-out-quad; // Ensure these vars are defined
  transition-property: background-color, border-color, color, box-shadow,
    transform, filter;
  will-change: transform, box-shadow;

  &:hover {
    filter: brightness(1.1);
  }
  &:active {
    transform: scale(0.97);
    filter: brightness(0.95);
  }

  &:disabled,
  &[disabled] {
    opacity: 0.5;
    cursor: not-allowed;
    pointer-events: none;
    filter: saturate(0.5);
  }

  &:focus-visible {
    // Ensure CSS variables like --color-bg-primary-h etc. are available from theme-engine
    @include commonMixins.focus-ring(
      '--color-bg-primary', 
      '--color-accent-primary'
    );
  }

  .icon {
    width: 1.2em;
    height: 1.2em;
  }
}

// ─────────────────────────────────────────────────────────────────────────────
// APPEARANCE (“look”) MIXINS
// ─────────────────────────────────────────────────────────────────────────────

@mixin btn-primary-look {
  background: linear-gradient(
    135deg,
    hsl(var(--color-accent-primary-h), var(--color-accent-primary-s), var(--color-accent-primary-l)),
    hsl(var(--color-accent-primary-h), var(--color-accent-primary-s), calc(var(--color-accent-primary-l) - 10%))
  );
  color: hsl(var(--color-text-on-primary-h), var(--color-text-on-primary-s), var(--color-text-on-primary-l));
  border-color: hsla(var(--color-accent-primary-h), var(--color-accent-primary-s), calc(var(--color-accent-primary-l) - 15%), 0.5);
  box-shadow: var(--shadow-depth-sm), 0 0 0 0 hsla(var(--color-accent-primary-h), var(--color-accent-primary-s), var(--color-accent-primary-l), 0);

  &:hover,
  &:focus-visible {
    // Combines base hover with primary specifics
    background: linear-gradient(
      135deg,
      hsl(var(--color-accent-primary-h), var(--color-accent-primary-s), calc(var(--color-accent-primary-l) + 5%)),
      hsl(var(--color-accent-primary-h), var(--color-accent-primary-s), var(--color-accent-primary-l))
    );
    box-shadow: var(--shadow-depth-md),
      0 0 12px 2px hsla(var(--color-accent-primary-h), var(--color-accent-primary-s), var(--color-accent-primary-l), 0.4);
    transform: translateY(-1px) scale(1); // Override base hover transform if needed
    filter: brightness(1.15);
  }
  &:active {
    // Combines base active with primary specifics
    background: linear-gradient(
      135deg,
      hsl(var(--color-accent-primary-h), var(--color-accent-primary-s), calc(var(--color-accent-primary-l) - 10%)),
      hsl(var(--color-accent-primary-h), var(--color-accent-primary-s), calc(var(--color-accent-primary-l) - 15%))
    );
    box-shadow: inset 0 2px 4px hsla(0, 0%, 0%, 0.2),
      0 0 8px 1px hsla(var(--color-accent-primary-h), var(--color-accent-primary-s), var(--color-accent-primary-l), 0.3);
    filter: brightness(0.9);
  }
}

@mixin btn-secondary-look {
  // Ensure all CSS variables for HSL components are correctly defined and available
  @include commonMixins.neomorphic-extrude(
    '--color-bg-secondary', // Prefix for HSL: --color-bg-secondary-h, -s, -l
    4px, 8px,
    '--shadow-opacity-soft', // CSS Var for opacity
    var.$radius-holographic-default, // SCSS var for radius
    '--shadow-color-h', // CSS Var
    '--shadow-color-s', // CSS Var
    '--shadow-color-l', // CSS Var
    '--shadow-highlight-modifier', // CSS Var for lightness modifier (e.g. '+10%')
    // SCSS Fallbacks (if CSS vars are not defined for some reason)
    var.$default-color-bg-secondary-h, var.$default-color-bg-secondary-s, var.$default-color-bg-secondary-l,
    var.$default-shadow-opacity-soft,
    var.$default-shadow-color-h, var.$default-shadow-color-s, var.$default-shadow-color-l,
    var.$default-shadow-highlight-modifier
  );
  color: hsl(var(--color-text-secondary-h), var(--color-text-secondary-s), var(--color-text-secondary-l));
  border-color: transparent; // Overrides base border if any

  &:hover {
    filter: brightness(1.05); // Base hover handles some brightness
  }
  &:active {
    @include commonMixins.neomorphic-inset(
      '--color-bg-secondary', // Prefix for HSL
      3px, 6px,
      '--shadow-opacity-soft', // CSS Var for opacity
      var.$radius-holographic-default,
      '--shadow-color-h', 
      '--shadow-color-s', 
      '--shadow-color-l', 
      '--shadow-highlight-modifier',
      // SCSS Fallbacks
      var.$default-color-bg-secondary-h, var.$default-color-bg-secondary-s, calc(var.$default-color-bg-secondary-l - 2%), // Slightly darker inset bg
      var.$default-shadow-opacity-soft,
      var.$default-shadow-color-h, var.$default-shadow-color-s, var.$default-shadow-color-l,
      var.$default-shadow-highlight-modifier
    );
    transform: scale(0.98); // Slightly different active scale
    filter: none;
  }
}

@mixin btn-ghost-look {
  background-color: transparent; // Moved to top
  color: hsl(var(--color-text-secondary-h), var(--color-text-secondary-s), var(--color-text-secondary-l)); // Moved to top
  border-color: transparent; // Moved to top
  padding: calc(var.$spacing-sm - 2px) calc(var.$spacing-lg - 2px);

  &:hover {
    background-color: hsla(var(--color-accent-secondary-h), var(--color-accent-secondary-s), var(--color-accent-secondary-l), 0.1);
    color: hsl(var(--color-accent-secondary-h), var(--color-accent-secondary-s), var(--color-accent-secondary-l));
    filter: none;
  }
  &:active {
    background-color: hsla(var(--color-accent-secondary-h), var(--color-accent-secondary-s), var(--color-accent-secondary-l), 0.15);
    filter: none;
  }
}

@mixin btn-error-look {
  background: linear-gradient(135deg,
    hsl(var(--color-error-h), var(--color-error-s), var(--color-error-l)),
    hsl(var(--color-error-h), var(--color-error-s), calc(var(--color-error-l) - 10%))
  );
  color: hsl(var(--color-text-on-primary-h), var(--color-text-on-primary-s), var(--color-text-on-primary-l)); // Assuming error bg is dark enough for light text
  border-color: hsla(var(--color-error-h), var(--color-error-s), calc(var(--color-error-l) - 15%), 0.5);
  box-shadow: var(--shadow-depth-sm), 0 0 0 0 hsla(var(--color-error-h), var(--color-error-s), var(--color-error-l), 0);

  &:hover,
  &:focus-visible {
    background: linear-gradient(135deg,
      hsl(var(--color-error-h), var(--color-error-s), calc(var(--color-error-l) + 5%)),
      hsl(var(--color-error-h), var(--color-error-s), var(--color-error-l))
    );
    box-shadow: var(--shadow-depth-md),
      0 0 12px 2px hsla(var(--color-error-h), var(--color-error-s), var(--color-error-l), 0.4);
  }
  &:active {
    background: linear-gradient(135deg,
      hsl(var(--color-error-h), var(--color-error-s), calc(var(--color-error-l) - 10%)),
      hsl(var(--color-error-h), var(--color-error-s), calc(var(--color-error-l) - 15%))
    );
    box-shadow: inset 0 2px 4px hsla(0,0%,0%,0.2),
      0 0 8px 1px hsla(var(--color-error-h), var(--color-error-s), var(--color-error-l), 0.3);
  }
}


// ─────────────────────────────────────────────────────────────────────────────
// SIZE / SHAPE MODIFIERS
// ─────────────────────────────────────────────────────────────────────────────
@mixin btn-icon-modifier {
  padding: var.$spacing-sm;
  gap: 0;
  .icon { width: 1.5em; height: 1.5em; } // Ensure icon class is applied to icon element
}

@mixin btn-xs-modifier {
  padding: calc(var.$spacing-xs * 0.75) var.$spacing-sm;
  font-size: var.$font-size-xs;
  border-radius: calc(var.$radius-holographic-default * 0.6);
  .icon { width: 0.8em; height: 0.8em; }
}
@mixin btn-sm-modifier {
  padding: calc(var.$spacing-xs * 1.5) var.$spacing-md;
  font-size: var.$font-size-sm;
  border-radius: calc(var.$radius-holographic-default * 0.8);
  .icon { width: 1em; height: 1em; }
}
@mixin btn-lg-modifier {
  padding: var.$spacing-md var.$spacing-xl;
  font-size: var.$font-size-lg;
  border-radius: calc(var.$radius-holographic-default * 1.2);
  .icon { width: 1.3em; height: 1.3em; }
}
@mixin btn-xl-modifier {
  padding: var.$spacing-lg var.$spacing-2xl;
  font-size: var.$font-size-xl;
  border-radius: calc(var.$radius-holographic-default * 1.5);
  .icon { width: 1.5em; height: 1.5em; }
}

// ─────────────────────────────────────────────────────────────────────────────
// COMPOSITE MIXINS (These combine base styles with a specific look)
// ─────────────────────────────────────────────────────────────────────────────
@mixin btn { @include base-button-styles; } // Base button with no specific "look" yet
@mixin btn-primary { @include base-button-styles; @include btn-primary-look; }
@mixin btn-secondary { @include base-button-styles; @include btn-secondary-look; }
@mixin btn-ghost { @include base-button-styles; @include btn-ghost-look; }
@mixin btn-error { @include base-button-styles; @include btn-error-look; }

// ─────────────────────────────────────────────────────────────────────────────
// (Optional) GLOBAL UTILITY CLASSES - Apply these directly in HTML
// e.g., <button class="btn btn-primary btn-sm">Click Me</button>
// ─────────────────────────────────────────────────────────────────────────────
.btn { @include btn; }
.btn-primary { @include btn-primary; }
.btn-secondary { @include btn-secondary; }
.btn-ghost { @include btn-ghost; }
.btn-error { @include btn-error; }

// Size modifiers (can be combined with variant classes)
.btn-icon { @include btn-icon-modifier; }
.btn-xs { @include btn-xs-modifier; }
.btn-sm { @include btn-sm-modifier; }
.btn-lg { @include btn-lg-modifier; }
.btn-xl { @include btn-xl-modifier; }

// Additional Ephemeral Harmony specific button classes (example)
// These would typically be defined using the composite mixins.
// For instance, UserSettingsDropdown.vue or SiteMenuDropdown.vue might use:
// <button class="btn btn-ghost btn-icon">...</button>
// Or a more specific class name that then @includes these mixins.

.btn-ghost-ephemeral { // A named utility class for ghost buttons in this theme
  @include btn-ghost;
  // Any additional overrides specific to "ephemeral" ghost buttons
  // For example, a slightly different padding or hover effect if needed.
}

.btn-primary-ephemeral {
  @include btn-primary;
}
.btn-secondary-ephemeral {
  @include btn-secondary;
}

// etc. for other variants if needed.